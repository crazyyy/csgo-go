function jivoMobileLabel(){if(document.querySelector("meta[name=viewport]")){for(var e,t=document.querySelector("meta[name=viewport]").getAttribute("content").split(","),i=!1,n=0;n<t.length;n++){t[n]=t[n].replace(/^\s+/,"");var o=t[n].split("=");"maximum-scale"==o[0]&&(i=!0,o[1]>1&&(o[1]="1.2")),t[n]=o[0]+"="+o[1]}i||t.push("maximum-scale=1.2"),e=t.join(", "),document.querySelector("meta[name=viewport]").setAttribute("content",e)}else{var s=document.createElement("meta");s.id="viewport",s.name="viewport",s.content="width=device-width, height=device-height, initial-scale=0.33, maximum-scale=1.2",document.getElementsByTagName("head")[0].appendChild(s)}setInterval(function(){if(document.getElementById("jivo-label")){var e=0,t=290,i=500,n=window.innerWidth||window.pageXOffset||document.documentElement.clientWidth||document.getElementsByTagName("html")[0],o=(n/t).toFixed(3);(window.matchMedia("(orientation: landscape)").matches||90===Math.abs(window.orientation))&&(o=(n/i).toFixed(3)),o!=e&&(document.getElementById("jivo-label").style.zoom=o,e=o)}},100)}(window.jivo_init=function(){function getElementsByClassName(e){var t;try{t=document.getElementsByClassName(e)}catch(i){t=[];for(var n=new RegExp("\\b"+e+"\\b"),o=document.getElementsByTagName("*"),s=0;s<o.length;s++){var r=o[s].className;n.test(r)&&t.push(o[s])}}return t}function log(){if("logs"in config){var e=Array.prototype.slice.call(arguments);if("undefined"!=typeof console&&"function"==typeof console.log)if(window.opera)for(var t=0;t<arguments.length;)console.log("Item "+(t+1)+": "+arguments[t]),t++;else console.log(1==e.length&&"string"==typeof e[0]?e.toString():e);else"undefined"!=typeof console&&"object"==typeof console.log&&Function.prototype.call.call(console.log,console,e)}}function addListener(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent&&(e.attachEvent("on"+t,function(e){return function(){i.call(e,window.event)}}(e)),e=null)}function removeEvent(e,t,i){if(window.removeEventListener)e.removeEventListener(t,i,!1);else{if(!window.detachEvent)return!1;var n=function(){i.call(e)};e.detachEvent("on"+t,n)}}function loadScript(e,t){var i=document.createElement("script");i.type="text/javascript",i.readyState?i.onreadystatechange=function(){("loaded"==i.readyState||"complete"==i.readyState)&&(i.onreadystatechange=null,t())}:i.onload=function(){t()},i.src=e,"undefined"!=typeof log&&log("adding script "+e),document.getElementsByTagName("head")[0].appendChild(i)}function setIframeLoadCallback(e,t){e.readyState?(log("Using readyState callback"),e.onreadystatechange=function(){("loaded"==e.readyState||"complete"==e.readyState)&&(e.onreadystatechange=null,t())}):(log("Using onload callback"),e.onload=function(){"about:blank"!=e.contentWindow.location.href&&(t(),e.onload=null)})}function installF9ReloadCss(){$("body").keydown(function(e){if("120"==e.keyCode){log("reloading css");var t,i,n;for(i=document.getElementsByTagName("link"),t=0;t<i.length;t++)if(n=i[t],n.rel.toLowerCase().indexOf("stylesheet")>=0&&n.href){var o=n.href.replace(/(&|%5C?)forceReload=\d+/,"");n.href=o+(o.indexOf("?")>=0?"&":"?")+"forceReload="+(new Date).valueOf()}}})}function translate(e){return"custom_langpack"in config&&e in config.custom_langpack?config.custom_langpack[e].replace(/\n/g,"<br />").replace(/'/g,"&#039;"):translate_basic(e)}function translate_basic(e){return e in base_langpack?base_langpack[e].replace(/\n/g,"<br />"):e}function reductionTranslate(e){return(config.locale="ru_RU")?e.substr(0,4):e}function cookie(e,t,i){if("__utmz"!=e&&(e=["jv",e,config.widget_id].join("_")),arguments.length>1&&"[object Object]"!==String(t)){if("undefined"==typeof i&&(i={}),null===t||void 0===t?(log("Clearing COOKIE "+e),i.expires=-1):log("Set COOKIE "+e+" with value "+t),"number"==typeof i.expires){var n=i.expires,o=i.expires=new Date;o.setDate(o.getDate()+n)}return t=String(t),document.cookie=[encodeURIComponent(e),"=",encodeURIComponent(t),i.expires?"; expires="+i.expires.toUTCString():"",config.cookie_domain&&!jivo.isSeparateWindow()?"; domain="+config.cookie_domain:"","; path=/"].join("")}i=t||{};var s,r=i.raw?function(e){return e}:decodeURIComponent;return(s=new RegExp("(?:^|; )"+encodeURIComponent(e)+"=([^;]*)").exec(document.cookie))?r(s[1]):null}function getJSONP(e,t){var i=new jivoXHR;i.open("GET",e),i.onload=t,i.send()}function getJSONPWithData(e,t,i){e+="?cb=?",t.t=(new Date).getTime();for(var n in t)e+="&"+n+"="+encodeURIComponent(t[n]);return getJSONP(e,i)}function reportException(e){if(!(++error_sent_cnt>3))try{getJSONPWithData("//err.jivosite.com/widget",{widget_id:config.widget_id,message:e.message,url:window.top.location.href,lineNumber:e.lineNumber,fileName:e.fileName},function(e){log(e)})}catch(e){log(e.message)}}function setUTMParams(e){var t,i,n=e.substr(e.indexOf("?")+1),o=n.split("&"),s="";for(i=o.length;i--;)t=o[i].split("="),t[0].indexOf("utm_")>=0&&(t=o[i],s+=(s.length>0?"|":"")+t.substr(t.indexOf("utm_")+4));s&&cookie("utm",s)}function createXPathFromElement(e){var t=document.getElementsByTagName("*");for(segs=[];e&&1==e.nodeType;e=e.parentNode)if(e.hasAttribute("id")){for(var n=0,o=0;o<t.length&&(t[o].hasAttribute("id")&&t[o].id==e.id&&n++,!(n>1));o++);if(1==n)return segs.unshift('id("'+e.getAttribute("id")+'")'),segs.join("/");segs.unshift(e.localName.toLowerCase()+'[@id="'+e.getAttribute("id")+'"]')}else if(e.hasAttribute("class"))segs.unshift(e.localName.toLowerCase()+'[@class="'+e.getAttribute("class")+'"]');else{for(i=1,sib=e.previousSibling;sib;sib=sib.previousSibling)sib.localName==e.localName&&i++;segs.unshift(e.localName.toLowerCase()+"["+i+"]")}return segs.length?"/"+segs.join("/"):null}function highlightUrls(e){var t=/(\s|"|'|^)((?:(?:http|https|ftp|ftps|mailto):\/\/)?)((?:[a-zA-Zа-яА-Я0-9]|[\~\!\#$\%\^\&\*\(\)\+\=\_\-\:\;?\/\[\]\{\}\`\.]|(?:,(?!\s)))*\.(?:рф|com|aero|biz|com|coop|edu|eu|gov|info|int|mil|museum|name|net|org|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sy|sz|tc|td|tf|tg|th|tj|tk|tm|tn|to|tp|tr|tt|tv|tw|tz|travel|xxx|ua|ug|uk|um|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw)(?:[a-zA-Zа-яА-Я0-9]|[\~\!\#$\%\^\&\*\(\)\+\=\_\-\:\;?\/\[\]\{\}\`\.]|(?:,(?!\s)))*)/gim;return stripBrackets(e).replace(t,function(e,t,i,n){i||(i="http://");var o=document.domain;if(o=o.replace("www.",""),-1==n.indexOf(o,0))var s="_blank";else var s="col_old_page";return t+"<a href='"+i+n+"' target='"+s+"'>"+n+"</a>"})}function nl2br(e){return e.replace(/\n/g,"<br />")}function stripBrackets(e){return underscore.isUndefined(e)?"":e.replace(/</g,"&lt;").replace(/>/g,"&gt;")}function splitClasses(e){return underscore.isArray(e)?e:e.replace(/^\s+|\s+$/g,"").split(/\s+/)}function forseRedraw(e){e.offsetHeight}function getClasses(e){return splitClasses(e.className)}function setClasses(e,t){var i=t.join(" ");e.className!==i&&(e.className=i,forseRedraw(e))}function removeProperty(e,t){e.style.removeProperty?e.style.removeProperty(t):e.style.removeAttribute(t)}function removeElement(e){e.parentNode.removeChild(e)}function prefixedEvent(e,t,i){for(var n=["webkit","moz","MS","o",""],o=0;o<n.length;o++)n[o]||(t=t.toLowerCase()),e.addEventListener(n[o]+t,i,!1)}function css3AnimationIsSupported(){var e=utils.browser,t=e.name;return!!("Firefox"===t&&e.mV>23||"Chrome"===t&&e.mV>28||"Safari"===t&&e.mV>5)}function switchClasses(e,t,i){removeClass(e,t),addClass(e,i)}function getOffsetRect(e){var t=e.getBoundingClientRect(),i=document.body,n=document.documentElement,o=window.pageYOffset||n.scrollTop||i.scrollTop,s=window.pageXOffset||n.scrollLeft||i.scrollLeft,r=n.clientTop||i.clientTop||0,a=n.clientLeft||i.clientLeft||0,c=t.top+o-r,l=t.left+s-a;return{top:Math.round(c),left:Math.round(l)}}function getElementPosition(e){function t(e){return e.compatMode&&"BackCompat"!=e.compatMode?e.documentElement:e.body}var i,n=e.ownerDocument,o=n.all&&!window.opera,s=o?t(n):n.defaultView||n.parentWindow,r={left:0,top:0};if(e.getBoundingClientRect)r=underscore.extend(r,e.getBoundingClientRect());else for(i=e;i;)r.left+=i.offsetLeft,r.top+=i.offsetTop,i=i.offsetParent;return r.width=e.offsetWidth,r.height=e.offsetHeight,r.windowWidth=o?s.clientWidth:s.innerWidth,r.windowHeight=o?s.clientHeight:s.innerHeight,r}function setElementPosition(e,t){return e.style.cssText+="; top: "+t.top+"px; left : "+t.left+"px; width : "+t.width+"px; height: "+t.height+"px",this}function getConfigContactsAsk(){var e=!0;underscore.each(["name","phone","email"],function(t){config.contacts_settings[t].show&&(e=!1)},this),e&&(config.contacts_ask=2)}function getIconLocale(){if(void 0===config.iconLocale){var e=underscore.find(["ru_RU","be","kk","uk"],function(e){return e===config.locale});config.iconLocale=e?e:"en"}return config.iconLocale}function getURLParam(e,t){for(var i=(t||window.location||"").search.substring(1),n=i.split("&"),o=0;o<n.length;o++){var s=n[o].split("=");if(s[0]==e)return decodeURIComponent(s[1])}}function getByIdFromParent(e){var t=window.parent.document,i=t.getElementById(e);return i&&$(i)}function staticUrl(e,t){return t||(e+="?rnd=100630"),config.static_host?"//"+config.static_host+e:config.base_url+e}function chatserverUrl(){var e=window.location.protocol+"//";return"comet"in config?(e+=config.comet.host,"https:"==window.location.protocol?"secure_port"in config.comet&&(e+=":"+config.comet.secure_port):"plain_port"in config.comet&&(e+=":"+config.comet.plain_port)):e+="node.jivosite.com",e+"/jsonp/"+underscore.toArray(arguments).join("/")}function hexToR(e){return parseInt(cutHex(e).substring(0,2),16)}function hexToG(e){return parseInt(cutHex(e).substring(2,4),16)}function hexToB(e){return parseInt(cutHex(e).substring(4,6),16)}function cutHex(e){return"#"==e.charAt(0)?e.substring(1,7):e}function rgbToHex(e,t,i){return toHex(e)+toHex(t)+toHex(i)}function toHex(e){return e=parseInt(e,10),isNaN(e)?"00":(e=Math.max(0,Math.min(e,255)),"0123456789ABCDEF".charAt((e-e%16)/16)+"0123456789ABCDEF".charAt(e%16))}function adjustLightness(e,t,i){var n=hexToR(e),o=hexToG(e),s=hexToB(e);log("r="+n+" g="+o+" b="+s);var r=ColorConverter.toHSV(new RGB(n,o,s));r.v=r.v>0?r.v*t:100*(t-1),r.s=r.s*i;var a=ColorConverter.toRGB(r),c=rgbToHex(a.r,a.g,a.b);return"#"+c}function getLightness(e){var t=hexToR(e),i=hexToG(e),n=hexToB(e),o=ColorConverter.toHSV(new RGB(t,i,n));return log("hsv.v="+o.v),o.v}function isLightColor(e){return getLightness(e)>65}function HSV(e,t,i){0>=e&&(e=0),0>=t&&(t=0),0>=i&&(i=0),e>360&&(e=360),t>100&&(t=100),i>100&&(i=100),this.h=e,this.s=t,this.v=i}function RGB(e,t,i){0>=e&&(e=0),0>=t&&(t=0),0>=i&&(i=0),e>255&&(e=255),t>255&&(t=255),i>255&&(i=255),this.r=e,this.g=t,this.b=i}function CMYK(e,t,i,n){0>=e&&(e=0),0>=t&&(t=0),0>=i&&(i=0),0>=n&&(n=0),e>100&&(e=100),t>100&&(t=100),i>100&&(i=100),n>100&&(n=100),this.c=e,this.m=t,this.y=i,this.k=n}var config=window.jivo_config;(function(){var e=this,t=e._,i={},n=Array.prototype,o=Object.prototype,s=(Function.prototype,n.push),r=n.slice,a=n.concat,c=o.toString,l=o.hasOwnProperty,u=n.forEach,d=n.map,h=n.reduce,f=n.reduceRight,g=n.filter,m=n.every,_=n.some,p=n.indexOf,v=n.lastIndexOf,b=Array.isArray,w=Object.keys,y=!1,E=function(e){return e instanceof E?e:this instanceof E?void(this._wrapped=e):new E(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=E),exports._=E):e._=E,E.VERSION="1.4.4";var C=E.each=E.forEach=function(e,t,n){if(null!=e)if(u&&e.forEach===u)e.forEach(t,n);else if(e.length===+e.length){for(var o=0,s=e.length;s>o;o++)if(t.call(n,e[o],o,e)===i)return}else for(var r in e)if(E.has(e,r)&&t.call(n,e[r],r,e)===i)return};E.map=E.collect=function(e,t,i){var n=[];return null==e?n:d&&e.map===d?e.map(t,i):(C(e,function(e,o,s){n[n.length]=t.call(i,e,o,s)}),n)};var j="Reduce of empty array with no initial value";E.reduce=E.foldl=E.inject=function(e,t,i,n){var o=arguments.length>2;if(null==e&&(e=[]),h&&e.reduce===h)return n&&(t=E.bind(t,n)),o?e.reduce(t,i):e.reduce(t);if(C(e,function(e,s,r){o?i=t.call(n,i,e,s,r):(i=e,o=!0)}),!o)throw new TypeError(j);return i},E.reduceRight=E.foldr=function(e,t,i,n){var o=arguments.length>2;if(null==e&&(e=[]),f&&e.reduceRight===f)return n&&(t=E.bind(t,n)),o?e.reduceRight(t,i):e.reduceRight(t);var s=e.length;if(s!==+s){var r=E.keys(e);s=r.length}if(C(e,function(a,c,l){c=r?r[--s]:--s,o?i=t.call(n,i,e[c],c,l):(i=e[c],o=!0)}),!o)throw new TypeError(j);return i},E.find=E.detect=function(e,t,i){var n;return T(e,function(e,o,s){return t.call(i,e,o,s)?(n=e,!0):void 0}),n},E.filter=E.select=function(e,t,i){var n=[];return null==e?n:g&&e.filter===g?e.filter(t,i):(C(e,function(e,o,s){t.call(i,e,o,s)&&(n[n.length]=e)}),n)},E.reject=function(e,t,i){return E.filter(e,function(e,n,o){return!t.call(i,e,n,o)},i)},E.every=E.all=function(e,t,n){t||(t=E.identity);var o=!0;return null==e?o:m&&e.every===m?e.every(t,n):(C(e,function(e,s,r){return(o=o&&t.call(n,e,s,r))?void 0:i}),!!o)};var T=E.some=E.any=function(e,t,n){t||(t=E.identity);var o=!1;return null==e?o:_&&e.some===_?e.some(t,n):(C(e,function(e,s,r){return o||(o=t.call(n,e,s,r))?i:void 0}),!!o)};E.contains=E.include=function(e,t){return null==e?!1:p&&e.indexOf===p?-1!=e.indexOf(t):T(e,function(e){return e===t})},E.invoke=function(e,t){var i=r.call(arguments,2),n=E.isFunction(t);return E.map(e,function(e){return(n?t:e[t]).apply(e,i)})},E.pluck=function(e,t){return E.map(e,function(e){return e[t]})},E.where=function(e,t,i){return E.isEmpty(t)?i?null:[]:E[i?"find":"filter"](e,function(e){for(var i in t)if(t[i]!==e[i])return!1;return!0})},E.findWhere=function(e,t){return E.where(e,t,!0)},E.max=function(e,t,i){if(!t&&E.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&E.isEmpty(e))return-(1/0);var n={computed:-(1/0),value:-(1/0)};return C(e,function(e,o,s){var r=t?t.call(i,e,o,s):e;r>=n.computed&&(n={value:e,computed:r})}),n.value},E.min=function(e,t,i){if(!t&&E.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&E.isEmpty(e))return 1/0;var n={computed:1/0,value:1/0};return C(e,function(e,o,s){var r=t?t.call(i,e,o,s):e;r<n.computed&&(n={value:e,computed:r})}),n.value},E.shuffle=function(e){var t,i=0,n=[];return C(e,function(e){t=E.random(i++),n[i-1]=n[t],n[t]=e}),n};var I=function(e){return E.isFunction(e)?e:function(t){return t[e]}};E.sortBy=function(e,t,i){var n=I(t);return E.pluck(E.map(e,function(e,t,o){return{value:e,index:t,criteria:n.call(i,e,t,o)}}).sort(function(e,t){var i=e.criteria,n=t.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(n>i||void 0===n)return-1}return e.index<t.index?-1:1}),"value")};var k=function(e,t,i,n){var o={},s=I(t||E.identity);return C(e,function(t,r){var a=s.call(i,t,r,e);n(o,a,t)}),o};E.groupBy=function(e,t,i){return k(e,t,i,function(e,t,i){(E.has(e,t)?e[t]:e[t]=[]).push(i)})},E.countBy=function(e,t,i){return k(e,t,i,function(e,t){E.has(e,t)||(e[t]=0),e[t]++})},E.sortedIndex=function(e,t,i,n){i=null==i?E.identity:I(i);for(var o=i.call(n,t),s=0,r=e.length;r>s;){var a=s+r>>>1;i.call(n,e[a])<o?s=a+1:r=a}return s},E.toArray=function(e){return e?E.isArray(e)?r.call(e):e.length===+e.length?E.map(e,E.identity):E.values(e):[]},E.size=function(e){return null==e?0:e.length===+e.length?e.length:E.keys(e).length},E.first=E.head=E.take=function(e,t,i){return null==e?void 0:null==t||i?e[0]:r.call(e,0,t)},E.initial=function(e,t,i){return r.call(e,0,e.length-(null==t||i?1:t))},E.last=function(e,t,i){return null==e?void 0:null==t||i?e[e.length-1]:r.call(e,Math.max(e.length-t,0))},E.rest=E.tail=E.drop=function(e,t,i){return r.call(e,null==t||i?1:t)},E.compact=function(e){return E.filter(e,E.identity)};var S=function(e,t,i){return C(e,function(e){E.isArray(e)?t?s.apply(i,e):S(e,t,i):i.push(e)}),i};E.flatten=function(e,t){return S(e,t,[])},E.without=function(e){return E.difference(e,r.call(arguments,1))},E.uniq=E.unique=function(e,t,i,n){E.isFunction(t)&&(n=i,i=t,t=!1);var o=i?E.map(e,i,n):e,s=[],r=[];return C(o,function(i,n){(t?n&&r[r.length-1]===i:E.contains(r,i))||(r.push(i),s.push(e[n]))}),s},E.union=function(){return E.uniq(a.apply(n,arguments))},E.intersection=function(e){var t=r.call(arguments,1);return E.filter(E.uniq(e),function(e){return E.every(t,function(t){return E.indexOf(t,e)>=0})})},E.difference=function(e){var t=a.apply(n,r.call(arguments,1));return E.filter(e,function(e){return!E.contains(t,e)})},E.zip=function(){for(var e=r.call(arguments),t=E.max(E.pluck(e,"length")),i=new Array(t),n=0;t>n;n++)i[n]=E.pluck(e,""+n);return i},E.object=function(e,t){if(null==e)return{};for(var i={},n=0,o=e.length;o>n;n++)t?i[e[n]]=t[n]:i[e[n][0]]=e[n][1];return i},E.indexOf=function(e,t,i){if(null==e)return-1;var n=0,o=e.length;if(i){if("number"!=typeof i)return n=E.sortedIndex(e,t),e[n]===t?n:-1;n=0>i?Math.max(0,o+i):i}if(p&&e.indexOf===p)return e.indexOf(t,i);for(;o>n;n++)if(e[n]===t)return n;return-1},E.lastIndexOf=function(e,t,i){if(null==e)return-1;var n=null!=i;if(v&&e.lastIndexOf===v)return n?e.lastIndexOf(t,i):e.lastIndexOf(t);for(var o=n?i:e.length;o--;)if(e[o]===t)return o;return-1},E.range=function(e,t,i){arguments.length<=1&&(t=e||0,e=0),i=arguments[2]||1;for(var n=Math.max(Math.ceil((t-e)/i),0),o=0,s=new Array(n);n>o;)s[o++]=e,e+=i;return s},E.bind=function(e,t){if(e.bind===y&&y)return y.apply(e,r.call(arguments,1));var i=r.call(arguments,2);return function(){return e.apply(t,i.concat(r.call(arguments)))}},E.partial=function(e){var t=r.call(arguments,1);return function(){return e.apply(this,t.concat(r.call(arguments)))}},E.bindAll=function(e){var t=r.call(arguments,1);return 0===t.length&&(t=E.functions(e)),C(t,function(t){e[t]=E.bind(e[t],e)}),e},E.memoize=function(e,t){var i={};return t||(t=E.identity),function(){var n=t.apply(this,arguments);return E.has(i,n)?i[n]:i[n]=e.apply(this,arguments)}},E.delay=function(e,t){var i=r.call(arguments,2);return setTimeout(function(){return e.apply(null,i)},t)},E.defer=function(e){return E.delay.apply(E,[e,1].concat(r.call(arguments,1)))},E.throttle=function(e,t){var i,n,o,s,r=0,a=function(){r=new Date,o=null,s=e.apply(i,n)};return function(){var c=new Date,l=t-(c-r);return i=this,n=arguments,0>=l?(clearTimeout(o),o=null,r=c,s=e.apply(i,n)):o||(o=setTimeout(a,l)),s}},E.debounce=function(e,t,i){var n,o;return function(){var s=this,r=arguments,a=function(){n=null,i||(o=e.apply(s,r))},c=i&&!n;return clearTimeout(n),n=setTimeout(a,t),c&&(o=e.apply(s,r)),o}},E.once=function(e){var t,i=!1;return function(){return i?t:(i=!0,t=e.apply(this,arguments),e=null,t)}},E.wrap=function(e,t){return function(){var i=[e];return s.apply(i,arguments),t.apply(this,i)}},E.compose=function(){var e=arguments;return function(){for(var t=arguments,i=e.length-1;i>=0;i--)t=[e[i].apply(this,t)];return t[0]}},E.after=function(e,t){return 0>=e?t():function(){return--e<1?t.apply(this,arguments):void 0}},E.keys=w||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var i in e)E.has(e,i)&&(t[t.length]=i);return t},E.values=function(e){var t=[];for(var i in e)E.has(e,i)&&t.push(e[i]);return t},E.pairs=function(e){var t=[];for(var i in e)E.has(e,i)&&t.push([i,e[i]]);return t},E.invert=function(e){var t={};for(var i in e)E.has(e,i)&&(t[e[i]]=i);return t},E.functions=E.methods=function(e){var t=[];for(var i in e)E.isFunction(e[i])&&t.push(i);return t.sort()},E.extend=function(e){return C(r.call(arguments,1),function(t){if(t)for(var i in t)e[i]=t[i]}),e},E.pick=function(e){var t={},i=a.apply(n,r.call(arguments,1));return C(i,function(i){i in e&&(t[i]=e[i])}),t},E.omit=function(e){var t={},i=a.apply(n,r.call(arguments,1));for(var o in e)E.contains(i,o)||(t[o]=e[o]);return t},E.defaults=function(e){return C(r.call(arguments,1),function(t){if(t)for(var i in t)null==e[i]&&(e[i]=t[i])}),e},E.clone=function(e){return E.isObject(e)?E.isArray(e)?e.slice():E.extend({},e):e},E.tap=function(e,t){return t(e),e};var N=function(e,t,i,n){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof E&&(e=e._wrapped),t instanceof E&&(t=t._wrapped);var o=c.call(e);if(o!=c.call(t))return!1;switch(o){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var s=i.length;s--;)if(i[s]==e)return n[s]==t;i.push(e),n.push(t);var r=0,a=!0;if("[object Array]"==o){if(r=e.length,a=r==t.length)for(;r--&&(a=N(e[r],t[r],i,n)););}else{var l=e.constructor,u=t.constructor;if(l!==u&&!(E.isFunction(l)&&l instanceof l&&E.isFunction(u)&&u instanceof u))return!1;for(var d in e)if(E.has(e,d)&&(r++,!(a=E.has(t,d)&&N(e[d],t[d],i,n))))break;if(a){for(d in t)if(E.has(t,d)&&!r--)break;a=!r}}return i.pop(),n.pop(),a};E.isEqual=function(e,t){return N(e,t,[],[])},E.isEmpty=function(e){if(null==e)return!0;if(E.isArray(e)||E.isString(e))return 0===e.length;for(var t in e)if(E.has(e,t))return!1;return!0},E.isElement=function(e){return!(!e||1!==e.nodeType)},E.isArray=b||function(e){return"[object Array]"==c.call(e)},E.isObject=function(e){return e===Object(e)},C(["Arguments","Function","String","Number","Date","RegExp"],function(e){E["is"+e]=function(t){return c.call(t)=="[object "+e+"]"}}),E.isArguments(arguments)||(E.isArguments=function(e){return!(!e||!E.has(e,"callee"))}),"function"!=typeof/./&&(E.isFunction=function(e){return"function"==typeof e}),E.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},E.isNaN=function(e){return E.isNumber(e)&&e!=+e},E.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==c.call(e)},E.isNull=function(e){return null===e},E.isUndefined=function(e){return void 0===e},E.has=function(e,t){return l.call(e,t)},E.noConflict=function(){return e._=t,this},E.identity=function(e){return e},E.times=function(e,t,i){for(var n=Array(e),o=0;e>o;o++)n[o]=t.call(i,o);return n},E.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var x={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};x.unescape=E.invert(x.escape);var O={escape:new RegExp("["+E.keys(x.escape).join("")+"]","g"),unescape:new RegExp("("+E.keys(x.unescape).join("|")+")","g")};E.each(["escape","unescape"],function(e){E[e]=function(t){return null==t?"":(""+t).replace(O[e],function(t){return x[e][t]})}}),E.result=function(e,t){if(null==e)return null;var i=e[t];return E.isFunction(i)?i.call(e):i},E.mixin=function(e){C(E.functions(e),function(t){var i=E[t]=e[t];E.prototype[t]=function(){var e=[this._wrapped];return s.apply(e,arguments),P.call(this,i.apply(E,e))}})};var A=0;E.uniqueId=function(e){var t=++A+"";return e?e+t:t},E.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var L=/(.)^/,D={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},M=/\\|'|\r|\n|\t|\u2028|\u2029/g;E.template=function(e,t,i){var n;i=E.defaults({},i,E.templateSettings);var o=new RegExp([(i.escape||L).source,(i.interpolate||L).source,(i.evaluate||L).source].join("|")+"|$","g"),s=0,r="__p+='";e.replace(o,function(t,i,n,o,a){return r+=e.slice(s,a).replace(M,function(e){return"\\"+D[e]}),i&&(r+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'"),n&&(r+="'+\n((__t=("+n+"))==null?'':__t)+\n'"),o&&(r+="';\n"+o+"\n__p+='"),s=a+t.length,t}),r+="';\n",i.variable||(r="with(obj||{}){\n"+r+"}\n"),r="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+r+"return __p;\n";try{n=new Function(i.variable||"obj","_",r)}catch(a){throw a.source=r,a}if(t)return n(t,E);var c=function(e){return n.call(this,e,E)};return c.source="function("+(i.variable||"obj")+"){\n"+r+"}",c},E.chain=function(e){return E(e).chain()};var P=function(e){return this._chain?E(e).chain():e};E.mixin(E),C(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=n[e];E.prototype[e]=function(){var i=this._wrapped;return t.apply(i,arguments),"shift"!=e&&"splice"!=e||0!==i.length||delete i[0],P.call(this,i)}}),C(["concat","join","slice"],function(e){var t=n[e];E.prototype[e]=function(){return P.call(this,t.apply(this._wrapped,arguments))}}),E.extend(E.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this);var machina=function(e,t){var i=[].slice,n="transition",o="handler",s="handling",r="handled",a="nohandler",c="transition",l="invalidstate",u="deferred",d="newfsm",h={makeFsmNamespace:function(){var e=0;return function(){return"fsm."+e++}}(),getDefaultOptions:function(){return{initialState:"uninitialized",eventListeners:{"*":[]},states:{},eventQueue:[],namespace:h.makeFsmNamespace(),targetReplayState:"",state:t,priorState:t,_priorAction:"",_currentAction:""}}};if(!e.deepExtend){var f={"*":function(e,t,i){e[t]=i},object:function(e,t,i){e[t]=_({},e[t]||{},i)},array:function(t,i,n){t[i]=[],e.each(n,function(e,n){f[m(e)](t[i],n,e)},this)}},g=function(t){return e.isArray(t)?"array":e.isDate(t)?"date":e.isRegExp(t)?"regex":typeof t},m=function(e){var t=g(e);return f[t]?t:"*"},_=function(t){return e.each(i.call(arguments,1),function(i){e.each(i,function(e,i){f[m(e)](t,i,e)})}),t};e.mixin({deepExtend:_})}var p=function(t){e.extend(this,t),e.defaults(this,h.getDefaultOptions()),this.initialize.apply(this,arguments),w.emit(d,this),this.initialState&&this.transition(this.initialState)};e.extend(p.prototype,{initialize:function(){},emit:function(t){var n=arguments;this.eventListeners["*"]&&e.each(this.eventListeners["*"],function(e){try{e.apply(this,i.call(n,0))}catch(t){reportException(t),log(t.message)}},this),this.eventListeners[t]&&e.each(this.eventListeners[t],function(e){try{e.apply(this,i.call(n,1))}catch(t){reportException(t),log(t.message)}},this)},handle:function(n){if(!this.inExitHandler){var c,l,u,d,h=this.states,f=this.state,g=i.call(arguments,0);this.currentActionArgs=g,h[f][n]||h[f]["*"]||this["*"]?(c=h[f][n]?n:"*",u="*"===c,h[f][c]?(l=h[f][c],d=f+"."+c):(l=this["*"],d="*"),this._currentAction||(this._currentAction=d),this.emit.call(this,s,{inputType:n,args:g.slice(1)}),e.isFunction(l)&&(l=l.apply(this,u?g:g.slice(1))),e.isString(l)&&this.transition(l),this.emit.call(this,r,{inputType:n,args:g.slice(1)}),this._priorAction=this._currentAction,this._currentAction="",this.processQueue(o)):this.emit.call(this,a,{inputType:n,args:g.slice(1)}),this.currentActionArgs=t}},transition:function(e){if(!this.inExitHandler&&e!==this.state){var t;if(this.states[e]){if(this.targetReplayState=e,this.priorState=this.state,this.state=e,t=this.priorState,this.states[t]&&this.states[t]._onExit&&(this.inExitHandler=!0,this.states[t]._onExit.call(this),this.inExitHandler=!1),this.emit.call(this,c,{fromState:t,action:this._currentAction,toState:e}),this.states[e]._onEnter)try{this.states[e]._onEnter.call(this)}catch(i){reportException(i),log(i.message)}return void(this.targetReplayState===e&&this.processQueue(n))}this.emit.call(this,l,{state:this.state,attemptedState:e})}},processQueue:function(t){var i=t===n?function(e){return e.type===n&&(!e.untilState||e.untilState===this.state)}:function(e){return e.type===o},s=e.filter(this.eventQueue,i,this);this.eventQueue=e.difference(this.eventQueue,s),e.each(s,function(e){this.handle.apply(this,e.args)},this)},clearQueue:function(t,i){if(t){var s;t===n?s=function(e){return e.type===n&&(i?e.untilState===i:!0)}:t===o&&(s=function(e){return e.type===o}),this.eventQueue=e.filter(this.eventQueue,s)}else this.eventQueue=[]},deferUntilTransition:function(e){if(this.currentActionArgs){var t={type:n,untilState:e,args:this.currentActionArgs};this.eventQueue.push(t),this.emit.call(this,u,{state:this.state,queuedArgs:t})}},deferUntilNextHandler:function(){if(this.currentActionArgs){var e={type:n,args:this.currentActionArgs};this.eventQueue.push(e),this.emit.call(this,u,{state:this.state,queuedArgs:e})}},on:function(e,t){var i=this;return i.eventListeners[e]||(i.eventListeners[e]=[]),i.eventListeners[e].push(t),{eventName:e,callback:t,off:function(){i.off(e,t)}}},off:function(t,i){t?this.eventListeners[t]&&(this.eventListeners[t]=i?e.without(this.eventListeners[t],i):[]):this.eventListeners={}}}),p.prototype.trigger=p.prototype.emit;var v=function(){},b=function(t,i,n){var o;return o=i&&i.hasOwnProperty("constructor")?i.constructor:function(){t.apply(this,arguments)},e.deepExtend(o,t),v.prototype=t.prototype,o.prototype=new v,i&&e.deepExtend(o.prototype,i),n&&e.deepExtend(o,n),o.prototype.constructor=o,o.__super__=t.prototype,o};p.extend=function(e,t){var i=b(this,e,t);return i.extend=this.extend,i};var w={Fsm:p,utils:h,on:function(e,t){return this.eventListeners[e]||(this.eventListeners[e]=[]),this.eventListeners[e].push(t),t},off:function(t,i){this.eventListeners[t]&&(this.eventListeners[t]=e.without(this.eventListeners[t],i))},trigger:function(t){var n=arguments,o=this.eventListeners[t]||[];o&&o.length&&e.each(o,function(e){e.apply(null,i.call(n,1))})},eventListeners:{newFsm:[]}};return w.emit=w.trigger,w}(_);(function(){var e,t,i,n;e=window.device,t={},window.device=t,n=window.navigator.userAgent.toLowerCase(),t.safari=function(){return i("safari")&&!t.chrome()},t.chrome=function(){return i("chrome")},t.ios=function(){return t.iphone()||t.ipod()||t.ipad()},t.iphone=function(){return i("iphone")},t.ipod=function(){return i("ipod")},t.ipad=function(){return i("ipad")},t.chromeIOS=function(){return i("crios")},t.android=function(){return i("android")},t.androidPhone=function(){return t.android()&&i("mobile")},t.androidTablet=function(){return t.android()&&!i("mobile")},t.blackberry=function(){return i("blackberry")||i("bb10")||i("rim")},t.blackberryPhone=function(){return t.blackberry()&&!i("tablet")},t.blackberryTablet=function(){return t.blackberry()&&i("tablet")},t.windows=function(){return i("windows")},t.windowsPhone=function(){return t.windows()&&i("phone")},t.windowsTablet=function(){return t.windows()&&i("touch")},t.fxos=function(){return(i("(mobile;")||i("(tablet;"))&&i("; rv:")},t.fxosPhone=function(){return t.fxos()&&i("mobile")},t.fxosTablet=function(){return t.fxos()&&i("tablet")},t.meego=function(){return i("meego")},t.cordova=function(){return window.cordova&&"file:"===location.protocol},t.mobile=function(){return t.androidPhone()||t.iphone()||t.ipod()||t.windowsPhone()||t.blackberryPhone()||t.fxosPhone()||t.meego()},t.tablet=function(){return t.ipad()||t.androidTablet()||t.blackberryTablet()||t.windowsTablet()||t.fxosTablet()},t.desktop=function(){return!t.tablet()&&!t.mobile()},t.portrait=function(){return window.innerHeight/window.innerWidth>1},t.landscape=function(){return window.innerHeight/window.innerWidth<1},t.noConflict=function(){return window.device=e,this},i=function(e){return-1!==n.indexOf(e)}}).call(this);var underscore=_.noConflict(),devicejs=device.noConflict();underscore.templateSettings.interpolate=/\{\{(.+?)\}\}/g;var ie8=-1==navigator.appVersion.indexOf("MSIE 8.")?!1:!0,ie9=-1==navigator.appVersion.indexOf("MSIE 9.")?!1:!0,ie=-1==navigator.appVersion.indexOf("MSIE")?!1:!0,dateFormat=function(){var e=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,t=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,i=/[^-+\dA-Z]/g,n=function(e,t){for(e=String(e),t=t||2;e.length<t;)e="0"+e;return e};return function(o,s,r){var a=dateFormat;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(o)||/\d/.test(o)||(s=o,
o=void 0),"string"==typeof o&&isNaN(new Date(o))&&(o=o.replace(/-/g,"/").replace("T"," ").split(".").shift()+"Z"),o=o?new Date(o):new Date,isNaN(o))throw SyntaxError("invalid date");s=String(a.masks[s]||s||a.masks["default"]),"UTC:"==s.slice(0,4)&&(s=s.slice(4),r=!0);var c=r?"getUTC":"get",l=o[c+"Date"](),u=o[c+"Day"](),d=o[c+"Month"](),h=o[c+"FullYear"](),f=o[c+"Hours"](),g=o[c+"Minutes"](),m=o[c+"Seconds"](),_=o[c+"Milliseconds"](),p=r?0:o.getTimezoneOffset(),v={d:l,dd:n(l),ddd:a.i18n.dayNames[u],dddd:a.i18n.dayNames[u+7],m:d+1,mm:n(d+1),mmm:a.i18n.monthNames[d],mmmm:a.i18n.monthNames[d+12],yy:String(h).slice(2),yyyy:h,h:f%12||12,hh:n(f%12||12),H:f,HH:n(f),M:g,MM:n(g),s:m,ss:n(m),l:n(_,3),L:n(_>99?Math.round(_/10):_),t:12>f?"a":"p",tt:12>f?"am":"pm",T:12>f?"A":"P",TT:12>f?"AM":"PM",Z:r?"UTC":(String(o).match(t)||[""]).pop().replace(i,""),o:(p>0?"-":"+")+n(100*Math.floor(Math.abs(p)/60)+Math.abs(p)%60,4),S:["th","st","nd","rd"][l%10>3?0:(l%100-l%10!=10)*l%10]};return s.replace(e,function(e){return e in v?v[e]:e.slice(1,e.length-1)})}}();dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};var base_langpack={b_onlineCallDefaultText:"Позвонить нам бесплатно!",cw_callAfter:"Звонок через",cw_callButtonText:"Перезвонить мне",cw_callFree:"Звонок бесплатный. Сервис предоставлен",cw_chat:"Чат",cw_chatWithOperator:"чат с оператором",cw_close:"Закрыть",cw_connecting:"Соединяем",cw_enterPhonePlaceholder:"Введите ваш телефон",cw_errInfoText:"Попробуйте позвонить еще раз, или напишите нам в чат.",cw_formCenterText:"Не нашли, что искали?",cw_form_second:"секунду",cw_form_secondd:"секунд",cw_form_seconds:"секунды",cw_pickUpPhone:"Возьмите трубку",cw_repeatCall:"перезвонить",cw_repeatCallAgain:"Перезвонить еще раз",cw_reportPlaceholder:"Сообщите о проблеме, мы разберемся!",cw_reportProblem:"сообщить о проблеме",cw_seconds:"секунд",cw_textSend:"отправить",cw_thxForCall:"Спасибо Вам за звонок!",cw_typeInChat:"написать в чат",cw_unableToConnect:"Не смогли соединиться?",cw_weCalling:"Мы вам звоним",cw_weRecallAfter:"Мы перезвоним вам через",c_callConnected:"Вызов установлен",c_callDisconnected:"Вызов завершен",c_callProcessing:"Вызываем оператора...",defCallformTitle:"Оставьте свой номер, и мы перезвоним вам",defOfflineFormText:"Оставьте свое сообщение в этой форме, и мы получим его на e-mail и обязательно ответим!",defOfflineWidgetLabel:"Отправьте нам сообщение",defOfflineWidgetLabelMobile:"Сообщение",defOnlineWidgetLabel:"Напишите нам, мы онлайн!",defOnlineWidgetLabelMobile:"Консультант",defRuleInvitationText:"Здравствуйте! Я могу вам чем-то помочь?",defRuleRetaining:"Пожалуйста, подождите. Сейчас операторы заняты, но скоро кто-нибудь освободится и ответит вам!",lblAgentDisconnected:"Оператор отключился",lblCallMe:"Позвонить",lblCaptcha:"Введите код с картинки",lblCaptchaError:"Неверный код, введите еще раз",lblChatEnded:"Диалог завершен",lblChatIsOnline:"Консультант онлайн",lblConnectedToAgent:"Напишите Ваше сообщение!",lblConnectionLost:"Соединение потеряно. Восстанавливаем...",lblDeclineFile:"Отклонить",lblDefaultCobrowseComment:"Обратите внимание",lblEnterMessageHere:"Введите сообщение и нажмите Enter",lblEvaluateCancel:"Отменить",lblEvaluatePlease:"Оцените качество обслуживания",lblEvaluateThanks:"Спасибо за оценку!",lblHangUp:"Завершить соединение",lblHangUpShort:"Завершить",lblIntroduceButton:"Представиться",lblIntroduceName:"Ваше имя",lblIntroduceRequest:"Представьтесь, пожалуйста",lblIntroduceRequestBefore:"Представьтесь и начните чат!",lblLeaveMessage:"Оставить сообщение",lblLookingForFreeAgent:"Подключаемся...",lblMessageError:"К сожалению, сообщение не было отправлено по техническим причинам",lblMessageHere:"Введите сообщение",lblNegative:"Плохо",lblNewMessage:"Новое сообщение!",lblNoOperators:"К сожалению, сейчас никто не может ответить",lblOfflineMessageSend:"Сообщение отправлено",lblOperatorsOnline:"Операторы онлайн",lblPencilHint:"Оператор набирает сообщение",lblPhoneHint:"Нажмите «Разрешить», чтобы использовать микрофон компьютера для разговора.\r\nВаша веб-камера использоваться не будет",lblPositive:"Хорошо",lblPwrBy:'Чат предоставлен <a href="http://jivosite.ru/_URL_" target="_blank"><span class="j1">Jivo</span><span class="j2">Site</span></a>',lblReceiveFile:"Принять",lblReopenedElseWhere:"Диалог открыт в другом окне",lblReply:"Ответить",lblSelectDep:"Выберите отдел",lblSend:"Отправить",lblSendBefore:"Начать диалог",lblSendingFile:"_AGENT_ передает Вам файл: _FILE_",lblThanks:"Спасибо!",lblThankYouMessage:"Спасибо за ваше сообщение! Мы&nbsp;обязательно свяжемся с&nbsp;Вами в ближайшее время",lblTransferred:"Диалог передан оператору _AGENT_",lblView:"Посмотреть",lblWaitForOperator:"Пожалуйста ожидайте ответа оператора...",lblWebPhoneFlashError:"Установленная версия Flash не позволяет совершить вызов. Вы можете воспользоваться чатом",lblWebPhoneMicError:"Не удалось подключить микрофон. Пожалуйста, воспользуйтесь чатом",lblWebPhoneNotAvail:"Вызов не возможен из-за проблем с подключением. Пожалуйста, воспользуйтесь чатом",lblWebPhoneNotConnected:"Не удалось установить голосовое соединение. Пожалуйста, воспользуйтесь чатом",lblYourEmail:"Ваш E-mail",lblYourMessage:"Ваше сообщение",lblYourPhone:"Ваш телефон",lnkCloseThisWindow:"Закрыть",lnkRestartChat:"Возобновить",ofl_enterEmail:"Пожалуйста, введите e-mail",ofl_enterMessage:"Пожалуйста, введите сообщение",ofl_enterName:"Пожалуйста, введите имя",ofl_enterValidEmail:"Указан неверный e-mail",ofl_enterValidPhone:"Указан неверный телефон",seo_copyrightTextNew:"Чат предоставлен _JIVOSITE_"},error_sent_cnt=0,CLASS_LIST_SUPPORTED="classList"in document.documentElement,hasClass=CLASS_LIST_SUPPORTED?function(e,t){return e.classList.contains(t)}:function(e,t){return""!==e.className&&underscore.contains(getClasses(e),t)},addClass=CLASS_LIST_SUPPORTED?function(e,t){underscore.each(splitClasses(t),function(t){e.classList.add(t)}),forseRedraw(e)}:function(e,t){var i=getClasses(e),n=underscore.union(i,splitClasses(t));setClasses(e,n)},removeClass=CLASS_LIST_SUPPORTED?function(e,t){underscore.each(splitClasses(t),function(t){e.classList.remove(t)}),forseRedraw(e)}:function(e,t){var i=getClasses(e),n=underscore.difference(i,splitClasses(t));setClasses(e,n)},toggleClass=CLASS_LIST_SUPPORTED?function(e,t,i){t=underscore.uniq(splitClasses(t)),underscore.each(t,function(t){e.classList.toggle(t,i)}),forseRedraw(e)}:function(e,t,i){var n,o=getClasses(e),s=[],r=[];underscore.each(splitClasses(t),function(e){var t=underscore.contains(o,e)?i!==!0&&r:i!==!1&&s;t&&t.push(e)}),n=underscore.union(underscore.difference(o,r),s),setClasses(e,n)},utils={fields:["client_name","phone","email"],showAd:function(){return!(8&config.options&&config.hide_ad)},hideOffline:function(){return config.hide_offline>0&&512&config.options},isValidValue_phone:function(e){return e.replace(/\D+/g,"").length>=5&&/^\+?[0-9() -]+$/i.test(e)},isValidValue_email:function(e){return e.length>=4&&/^.+@.+\..+$/i.test(e)},isValidValue_name:function(e){return e.length>0}};!function(e){if(!e.browser){e.browser={},e.browser.mozilla=!1,e.browser.webkit=!1,e.browser.opera=!1,e.browser.msie=!1;var t=navigator.userAgent;e.browser.ua=t,e.browser.name=navigator.appName,e.browser.fV=""+parseFloat(navigator.appVersion),e.browser.mV=parseInt(navigator.appVersion,10);var i,n,o;if(-1!=(n=t.indexOf("Opera")))e.browser.opera=!0,e.browser.name="Opera",e.browser.fV=t.substring(n+6),-1!=(n=t.indexOf("Version"))&&(e.browser.fV=t.substring(n+8));else if(-1!=(n=t.indexOf("MSIE")))e.browser.msie=!0,e.browser.name="Microsoft Internet Explorer",e.browser.fV=t.substring(n+5);else if(-1!=t.indexOf("Trident")){e.browser.msie=!0,e.browser.name="Microsoft Internet Explorer";var s=t.indexOf("rv:")+3,r=s+4;e.browser.fV=t.substring(s,r)}else-1!=(n=t.indexOf("Chrome"))?(e.browser.webkit=!0,e.browser.name="Chrome",e.browser.fV=t.substring(n+7)):-1!=(n=t.indexOf("Safari"))?(e.browser.webkit=!0,e.browser.name="Safari",e.browser.fV=t.substring(n+7),-1!=(n=t.indexOf("Version"))&&(e.browser.fV=t.substring(n+8))):-1!=(n=t.indexOf("AppleWebkit"))?(e.browser.webkit=!0,e.browser.name="Safari",e.browser.fV=t.substring(n+7),-1!=(n=t.indexOf("Version"))&&(e.browser.fV=t.substring(n+8))):-1!=(n=t.indexOf("Firefox"))?(e.browser.mozilla=!0,e.browser.name="Firefox",e.browser.fV=t.substring(n+8)):(i=t.lastIndexOf(" ")+1)<(n=t.lastIndexOf("/"))&&(e.browser.name=t.substring(i,n),e.browser.fV=t.substring(n+1),e.browser.name.toLowerCase()==e.browser.name.toUpperCase()&&(e.browser.name=navigator.appName));-1!=(o=e.browser.fV.indexOf(";"))&&(e.browser.fV=e.browser.fV.substring(0,o)),-1!=(o=e.browser.fV.indexOf(" "))&&(e.browser.fV=e.browser.fV.substring(0,o)),e.browser.mV=parseInt(""+e.browser.fV,10),isNaN(e.browser.mV)&&(e.browser.fV=""+parseFloat(navigator.appVersion),e.browser.mV=parseInt(navigator.appVersion,10)),e.browser.version=e.browser.mV}}(utils);var ColorConverter={_RGBtoHSV:function(e){var t=new HSV(0,0,0),i=e.r/255,n=e.g/255,o=e.b/255,s=Math.min(i,n,o),r=Math.max(i,n,o),a=r-s;if(t.v=r,0==a)t.h=0,t.s=0;else{t.s=a/r;var c=((r-i)/6+a/2)/a,l=((r-n)/6+a/2)/a,u=((r-o)/6+a/2)/a;i==r?t.h=u-l:n==r?t.h=1/3+c-u:o==r&&(t.h=2/3+l-c),t.h<0&&(t.h+=1),t.h>1&&(t.h-=1)}return t.h=Math.round(360*t.h),t.s=Math.round(100*t.s),t.v=Math.round(100*t.v),t},_HSVtoRGB:function(e){var t=new RGB(0,0,0),i=e.h/360,n=e.s/100,o=e.v/100;if(0==n)t.r=255*o,t.g=255*o,t.b=255*o;else{var s=6*i,r=Math.floor(s),a=o*(1-n),c=o*(1-n*(s-r)),l=o*(1-n*(1-(s-r)));0==r?(var_r=o,var_g=l,var_b=a):1==r?(var_r=c,var_g=o,var_b=a):2==r?(var_r=a,var_g=o,var_b=l):3==r?(var_r=a,var_g=c,var_b=o):4==r?(var_r=l,var_g=a,var_b=o):(var_r=o,var_g=a,var_b=c),t.r=255*var_r,t.g=255*var_g,t.b=255*var_b,t.r=Math.round(t.r),t.g=Math.round(t.g),t.b=Math.round(t.b)}return t},_CMYKtoRGB:function(e){var t=new RGB(0,0,0),i=e.c/100,n=e.m/100,o=e.y/100,s=e.k/100;return t.r=1-Math.min(1,i*(1-s)+s),t.g=1-Math.min(1,n*(1-s)+s),t.b=1-Math.min(1,o*(1-s)+s),t.r=Math.round(255*t.r),t.g=Math.round(255*t.g),t.b=Math.round(255*t.b),t},_RGBtoCMYK:function(e){var t=new CMYK(0,0,0,0),i=e.r/255,n=e.g/255,o=e.b/255;return t.k=Math.min(1-i,1-n,1-o),t.c=(1-i-t.k)/(1-t.k),t.m=(1-n-t.k)/(1-t.k),t.y=(1-o-t.k)/(1-t.k),t.c=Math.round(100*t.c),t.m=Math.round(100*t.m),t.y=Math.round(100*t.y),t.k=Math.round(100*t.k),t},toRGB:function(e){return e instanceof RGB?e:e instanceof HSV?this._HSVtoRGB(e):e instanceof CMYK?this._CMYKtoRGB(e):void 0},toHSV:function(e){return e instanceof HSV?e:e instanceof RGB?this._RGBtoHSV(e):e instanceof CMYK?this._RGBtoHSV(this._CMYKtoRGB(e)):void 0},toCMYK:function(e){return e instanceof CMYK?e:e instanceof RGB?this._RGBtoCMYK(e):e instanceof HSV?this._RGBtoCMYK(this._HSVtoRGB(e)):void 0}};machina.on("newfsm",function(e){e.on("handling",function(e){log(this.namespace+": handling "+e.inputType+" in state "+this.state)}),e.on("nohandler",function(e){log(this.namespace+": unhandled "+e.inputType+" in state "+this.state)}),e.on("transition",function(e){log([this.namespace+":","transition from:",e.fromState,"to:",e.toState,"action:",e.action].join(" "))})});var TimeMachine=machina.Fsm.extend({_fireEvent:function(e){delete this._scheduled_events[e],this.handle(e)},_scheduleEvent:function(e,t){e in this._scheduled_events?log(this.namespace+": attempt to re-schedule event"+e):(log(this.namespace+": scheduling "+e+" for "+t),this._scheduled_events[e]=setTimeout(underscore.bind(this._fireEvent,this,e),t))},_cancelEvent:function(e){e in this._scheduled_events?(clearTimeout(this._scheduled_events[e]),delete this._scheduled_events[e]):log(this.namespace+": attempt to cancel not scheduled event",e)},constructor:function(){this._scheduled_events={},machina.Fsm.apply(this,arguments)}}),Rule=TimeMachine.extend({initialize:function(){this.namespace="RULE#"+this.name.replace(" ","_"),this.initialState="unreachable";for(var e,t=[],i=!1;e=this.conditions.pop();)if(this.isTimeCondition(e))t.push(e);else if(this.isABTestCondition(e)){if(this.ab_test_group=e.value,!cookie("ab_test_group")){var n=Math.round(Math.random()),o=e.group_name?e.group_name:"JivoSite A/B Group";cookie("ab_test_group",n?"group_a":"group_b"),analytics.setABTestGroupContacts(o,n?"Group A":"Group B")}}else if("page_url"===e.condition&&(e.value=e.value.replace("http://","").replace("https://","")),this.checkCondition(e))i=!0;else if("all"===this.type)return;return t.length>0?(this.conditions=t,void(this.initialState=this.checkTimeConditions()?"triggered":"time_wait")):void(i&&(this.initialState="triggered"))},checkTimeConditions:function(){for(var e=!1,t=0;t<this.conditions.length;t++)if(this.checkCondition(this.conditions[t]))e=!0;else if("all"===this.type)return!1;return e},isTimeCondition:function(e){return e.condition.indexOf("time")>=0},isABTestCondition:function(e){return"ab_test_group"===e.condition},checkCondition:function(e){var t=this.getValue(e.condition),i=this.compare(t,e.value,e.comparator);return i||log(this.namespace+": failed condition "+e.condition+"; expected="+e.value+"; actual="+t),i},getValue:function(e){switch(e){case"online":return"online"===config.chat_mode;case"page_url":return window.location.href.replace("http://","").replace("https://","");case"hour":return(new Date).getHours();case"page_title":return document.title;case"week_day":return(new Date).getDay();case"time_after_close":var t=cookie("close_time");return null===t?Number.MAX_VALUE:this.timeDiff(t);case"time_after_first_message":return null!==ruleManager.firstMessageTime?this.timeDiff(ruleManager.firstMessageTime.getTime()):0/0;case"time_after_invitation":var i=cookie("invitation_time");return null===i||""===i?Number.MAX_VALUE:this.timeDiff(i);case"time_on_page":return this.timeDiff(ruleManager.pageEnterTime);case"time_on_site":return this.timeDiff(cookie("enter_ts"));default:return cookie(e)}},timeDiff:function(e){return Math.round(((new Date).getTime()-e)/1e3)},compare:function(e,t,i){switch(i){case"contain":return-1!=e.toLowerCase().indexOf(t.toLowerCase());case"greater":return e>t;case"greater_equal":return e>=t;case"lower":return t>e;case"lower_equal":return t>=e;case"not_contain":return-1===e.toLowerCase().indexOf(t.toLowerCase());case"not_equal":return t!=e;case"regexp":return new RegExp(e,"i").test(t);default:return t===e}},states:{time_wait:{_onEnter:function(){this._scheduleEvent("tick",1e3)},tick:function(){this.checkTimeConditions()?this.transition("triggered"):this._scheduleEvent("tick",1e3)},cancel:"unreachable"},unreachable:{},triggered:{_onEnter:function(){var e=this.commands[0];if(!this.ab_test_group||this.ab_test_group&&this.ab_test_group===cookie("ab_test_group"))switch(e.command){case"proactive":ruleManager.showProactive(e.params.message,e.params.department,this.name);break;case"open_offline":if("online"===config.chat_mode)return;cookie("invitation_time",(new Date).getTime()),e.params&&(e.params.title&&(config.offline_form_title=e.params.title),e.params.message&&(config.offline_form_text=e.params.message)),jivo.isMobileOrTablet()||setTimeout(underscore.bind(jivo.handle,jivo,"gui_maximize"),0);break;case"hide":jivo.handle("hide");break;case"system_message":jivo.handle("system_message",{message:e.params.message})}}}}}),ruleManager=new TimeMachine({initialState:!1,isInited:!1,namespace:"ruleManager",rules:[],init:function(){return underscore.defaults(config,{rules:[]}),this.pageEnterTime=(new Date).getTime(),cookie("pages_count")?cookie("pages_count",parseInt(cookie("pages_count"))+1):cookie("pages_count",1),jivo.on("handling",underscore.bind(this.onJivoHandling,this)),0==config.rules.length&&underscore.isArray(config.proactive_rules)&&config.proactive_rules.length>0?(this.importLegacy(),void this.transition("ready")):this.needGeo()?void this.transition("fetch_geo"):(this.isInited=!0,void this.transition("ready"))},needGeo:function(){for(var e,t,i=0;i<config.rules.length;i++){e=config.rules[i];for(var n=0;n<e.conditions.length;n++)if(t=e.conditions[n],("country"==t.condition||"city"==t.condition)&&null==cookie("country"))return!0}return!1},states:{fetch_geo:{_onEnter:function(){getJSONP(config.base_url+"/script/geo?cb=?",underscore.bind(this.handle,this,"geo_data"))},geo_data:function(e){cookie("country",e.country,{expires:1}),cookie("city",e.city,{expires:1}),this.transition("ready")}},ready:{_onEnter:function(){for(var e=0;e<config.rules.length;e++)this.rules.push(new Rule(config.rules[e]));log(this.namespace+": rules count="+this.rules.length+"; wait count="+underscore.where(this.rules,{state:"time_wait"}).length),this.emit("ready")}}},firstMessageTime:null,canInvite:!0,importLegacy:function(){log(this.namespace+": importing from proactive_rules");for(var e,t=["contain","equal","regexp"],i=0;i<config.proactive_rules.length;i++){e=config.proactive_rules[i],underscore.defaults(e,{name:e.invitationText,urlPrefix:[{url:"/",mm:0}],page_timeout:20,close_timeout:300,enter_timeout:0,pages_count:0});for(var n=0;n<e.urlPrefix.length;n++)config.rules.push({legacyId:e.id,name:e.name,type:"all",conditions:[{condition:"online",value:!0},{condition:"time_on_page",comparator:"greater_equal",value:e.page_timeout},{condition:"time_after_close",comparator:"greater_equal",value:e.close_timeout},{condition:"time_on_site",comparator:"greater_equal",value:e.enter_timeout},{condition:"pages_count",comparator:"greater_equal",value:e.pages_count},{condition:"page_url",comparator:t[e.urlPrefix[n].mm],value:e.urlPrefix[n].url}],commands:[{command:"proactive",params:{message:e.invitationText}}]})}},onJivoHandling:function(e){switch(e.inputType){case"gui_minimize":cookie("close_time",(new Date).getTime());break;case"gui_message":this.firstMessageTime||(this.firstMessageTime=new Date),this.cancelInvites();break;case"accept":this.allRulesCancel();break;case"gui_maximize":1==config.contacts_ask&&this.cancelInvites();break;case"invitation":cookie("invitation_time",(new Date).getTime());break;case"api_open":e.args&&"object"==typeof e.args[0]&&"call"===e.args[0].start&&this.allRulesCancel()}},cancelInvites:function(){log(this.namespace+": cancelInvites");for(var e=0;e<this.rules.length;e++)"time_wait"==this.rules[e].state&&"proactive"==this.rules[e].commands[0].command&&this.rules[e].handle("cancel");this.canInvite=!1},allRulesCancel:function(){for(var e=0;e<this.rules.length;e++)"time_wait"===this.rules[e].state&&this.rules[e].handle("cancel")},restoreAgentInfo:function(){var e=cookie("agent_info");if(e){var t=e.split("$$");return{agent_id:t[0]}}return!1},showProactive:function(e,t,i){if(this.canInvite){if("number"==typeof e){var n=parseInt(e),o=!1;if(n){for(var s=0;s<this.rules.length;s++)if("proactive"==this.rules[s].commands[0].command&&this.rules[s].legacyId==n){e=this.rules[s].commands[0].params.message,log(this.namespace+": legacy rule found by ID="+n+"; message="+e),o=!0;break}if(!o)return void log(this.namespace+": legacy rule not found by ID="+n)}}this.cancelInvites();var r=this.restoreAgentInfo(),a={name:"active_agent"};t&&config.departments&&underscore.findWhere(config.departments,{id:t})&&(a.department=t),r&&(a.agent_id=r.agent_id),cookie("client_id")&&(a.jv_client_id=cookie("client_id")),getJSONPWithData(chatserverUrl(config.widget_id,config.site_id),a,underscore.bind(jivo.handle,jivo,"invitation",{name:i,invitationText:e}))}}}),_templates={content:underscore.template(["<!DOCTYPE html>","<html>","<head>","<meta charset='utf-8'>","<link rel='stylesheet' href='"+staticUrl("/css/chat.css")+"'/>","<!--[if lte IE 8]>","<link rel='stylesheet' href='"+staticUrl("/css/chat-ie8.css")+"' type='text/css' media='all'/>","<![endif]-->","<script src='"+staticUrl("/vendor-js/voximplant.min.js")+"'></script>","<meta name='viewport' content='width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no'>","<title>{{ title }}</title>","</head>","<body id='inner-chat' <% if (jivo.isTablet()) {%>class='tablet-version-widget'<% } %>>","<div id='web_phone' class='phone_hidden'>","<div id='rtc_placeholder'></div>","<div id='up_arrow'></div>","<div id='phone_hint'></div>","</div>","<div id='sound_player'></div>","<div id='contents_placeholder'></div>","<script src='"+staticUrl("/js/chat_"+config.locale+".js")+"' charset='UTF-8'></script>","</body>","</html>"].join("\n")),chat:underscore.template(["<div dir='ltr' class='jivo-triangle-wraper {{ jivo_config.style_string }}'>","<div class='jivo-triangle-clip'>","<div class='jivo-triangle jivo-chat-triangle'><div class='jivo-triangle-inner'></div></div>","<div class='jivo-noise jivo-noise-pattern'></div>","<div class='jivo-css-leaf jivo-{{ jivo_config.chat_mode }} jivo-{{ jivo_config.widget_font_color }}'>","<div class='jivo-top-right-square'>","<div class='jivo-bottom-left-square'></div>","</div>","</div>","</div>","</div>","<div id='jivo-drag-handle'></div>","<div id='jivo-mouse-tracker' style='display: none'></div>","<div dir='ltr' id='jivo_action' class='jivo-{{ mobile }}'>","<div id='jivo_close_button' data-action='close'></div>","</div>","<div id='jivo_iframe_wrap'>","<div id='jivo_iframe_placeholder'></div>","</div>","<div class='jivo-loader' id='jivo-loader'>","<div class='jivo-loader-title' id='jivo-loader-title'>{{ lblLookingForFreeAgent }}</div>","<div class='jivo-loader-inner'></div>","</div>"].join("\n")),label:{top:underscore.template(["<div id='jivo_chat_widget_online'>","<div id='jivo-label' class='jivo-fixed-{{ orientation }} jivo-animate jivo-{{ jivo_config.chat_mode }}'>","<div class='jivo-triangle-wraper {{ jivo_config.style_string }}'>","<div class='jivo-triangle-clip'>","<div class='jivo-triangle jivo-label-triangle'><div class='jivo-triangle-inner'></div></div>","<div class='jivo-noise jivo-noise-pattern-{{ jivo_config.widget_font_color }}'></div>","<div class='jivo-css-leaf jivo-{{ jivo_config.chat_mode }} jivo-{{ jivo_config.widget_font_color }}'>","<div class='jivo-top-right-square'>","<div class='jivo-bottom-left-square'></div>","</div>","</div>","</div>","</div>","<div id='jivo-label-wrapper' style='height: {{ height }}px'>","<div id='jivo-label-copyright' class='jivo-{{ type }} <% if (locale) {%>jivo-{{ locale }}<% } %>'></div>","<div id='jivo-label-text' <% if (locale) {%>class='jivo-{{ locale }}'<% } %>>{{ text }}</div>","<div id='jivo-label-indicator'></div>","<div id='jivo-label-status' class='jivo-{{ type }}'></div>","</div>","</div>","</div>"].join("\n")),bottom:underscore.template(["<div id='jivo_chat_widget_online'>","<div id='jivo-label' class='jivo-fixed-{{ orientation }} jivo-animate jivo-{{ jivo_config.chat_mode }}'>","<div class='jivo-triangle-wraper {{ jivo_config.style_string }}'>","<div class='jivo-triangle-clip'>","<div class='jivo-triangle jivo-label-triangle'><div class='jivo-triangle-inner'></div></div>","<div class='jivo-noise jivo-noise-pattern-{{ jivo_config.widget_font_color }}'></div>","<div class='jivo-css-leaf jivo-{{ jivo_config.chat_mode }} jivo-{{ jivo_config.widget_font_color }}'>","<div class='jivo-top-right-square'>","<div class='jivo-bottom-left-square'></div>","</div>","</div>","</div>","</div>","<div id='jivo-label-wrapper' style='height: {{ height }}px'>","<div id='jivo-label-status' class='jivo-{{ type }}'></div>","<div id='jivo-label-text' <% if (locale) {%>class='jivo-{{ locale }}'<% } %>>{{ text }}</div>","<div id='jivo-label-indicator'></div>","<div id='jivo-label-copyright' class='jivo-{{ type }} <% if (locale) {%>jivo-{{ locale }}<% } %>'></div>","</div>","</div>","</div>"].join("\n")),left:underscore.template(["<div id='jivo_chat_widget_online'>","<div id='jivo-label' class='jivo-fixed-{{ orientation }} jivo-animate jivo-{{ jivo_config.chat_mode }}'>","<div class='jivo-triangle-wraper {{ jivo_config.style_string }}'>","<div class='jivo-triangle-clip'>","<div class='jivo-triangle jivo-label-triangle'><div class='jivo-triangle-inner'></div></div>","<div class='jivo-noise jivo-noise-pattern-{{ jivo_config.widget_font_color }}'></div>","<div class='jivo-css-leaf jivo-{{ jivo_config.chat_mode }} jivo-{{ jivo_config.widget_font_color }}'>","<div class='jivo-top-right-square'>","<div class='jivo-bottom-left-square'></div>","</div>","</div>","</div>","</div>","<div id='jivo-label-wrapper' style='width: {{ height }}px'>","<div id='jivo-label-copyright' class='jivo-{{ type }} <% if (locale) {%>jivo-{{ locale }}<% } %>'></div>","<div id='jivo-label-text' class='jivo-{{ type }} <% if (locale) {%>jivo-{{ locale }}<% } %>'>","<div id='jivo-text-container'>","<div>{{ text }}</div>","</div>","</div>","<div id='jivo-label-status' class='jivo-{{ type }}'></div>","<div id='jivo-label-indicator'></div>","</div>","</div>","</div>"].join("\n")),right:underscore.template(["<div id='jivo_chat_widget_online'>","<div id='jivo-label' class='jivo-fixed-{{ orientation }} jivo-animate jivo-{{ jivo_config.chat_mode }}'>","<div class='jivo-triangle-wraper {{ jivo_config.style_string }}'>","<div class='jivo-triangle-clip'>","<div class='jivo-triangle jivo-label-triangle'><div class='jivo-triangle-inner'></div></div>","<div class='jivo-noise jivo-noise-pattern-{{ jivo_config.widget_font_color }}'></div>","<div class='jivo-css-leaf jivo-{{ jivo_config.chat_mode }} jivo-{{ jivo_config.widget_font_color }}'>","<div class='jivo-top-right-square'>","<div class='jivo-bottom-left-square'></div>","</div>","</div>","</div>","</div>","<div id='jivo-label-wrapper' style='width: {{ height }}px'>","<div id='jivo-label-copyright' class='jivo-{{ type }} <% if (locale) {%>jivo-{{ locale }}<% } %>'></div>","<div id='jivo-label-text' class='jivo-{{ type }} <% if (locale) {%>jivo-{{ locale }}<% } %>'>","<div id='jivo-text-container'>","<div>{{ text }}</div>","</div>","</div>","<div id='jivo-label-status' class='jivo-{{ type }}'></div>","<div id='jivo-label-indicator'></div>","</div>","</div>","</div>"].join("\n"))}},JivoWidget=TimeMachine.extend({namespace:"WIDG",fade:!1,position:{},initialState:"HIDDEN",initialize:function(){this._templateData={orientation:config.widget_orientation,height:config.widget_height,style:config.style_string,text:"online"==config.chat_mode?config.online_widget_label:config.offline_widget_label,type:config.widget_font_color,locale:getIconLocale()},this._widgetDiv=document.createElement("div"),this._widgetDiv.onclick=underscore.bind(this.handle,this,"click"),this._widgetDiv.setAttribute("id","jivo_chat_widget"),this._widgetDiv.innerHTML=_templates.label[config.widget_orientation](this._templateData),this.topWrap.appendChild(this._widgetDiv),this._el=document.getElementById("jivo-label"),this.setColor(),this.setFontStyle(),this.setPosition()},isCustom:function(){var e=this._widgetDiv.currentStyle?this._widgetDiv.currentStyle.display:getComputedStyle(this._widgetDiv,null).display;return"none"==e},states:{VISIBLE:{_onEnter:function(){jivo.transferProportion({width:document.getElementById("jivo-label").offsetWidth,height:config.widget_height-0}),this._el.style.display="block",this._el.style.visibility="visible",this.fade&&addClass(this._el,"jivo-fade-in")},click:function(){jivo.isClicked=!0,jivo.handle("gui_maximize")},hide:"HIDDEN"},HIDDEN:{_onEnter:function(){removeClass(this._el,"jivo-fade-in"),this._el.style.visibility="hidden"},show:"VISIBLE",hide:function(){}}},getOffset:function(e){for(var t=0,i=0;e&&!isNaN(e.offsetLeft)&&!isNaN(e.offsetTop);)t+=e.offsetLeft-e.scrollLeft,i+=e.offsetTop-e.scrollTop,e=e.offsetParent;return{top:i,left:t}},setText:function(e){if(this._widgetDiv&&"left"!=config.widget_orientation&&"right"!=config.widget_orientation){var t=document.getElementById("jivo-label-text");t.innerHTML=e,this.setPosition(),this.position=getElementPosition(this._el)}},setColor:function(){this._containerDiv=document.getElementById("jivo-label-wrapper"),this._textContainer=document.getElementById("jivo-label-text");for(var e=getElementsByClassName("jivo-label-triangle"),t=0;t<e.length;t++)switch(config.widget_orientation){case"top":e[t].style.borderTopColor=config.widget_color;break;case"bottom":e[t].style.borderLeftColor=config.widget_color;break;case"right":e[t].style.borderBottomColor=config.widget_color;break;case"left":e[t].style.borderLeftColor=config.widget_color}for(var e=getElementsByClassName("jivo-triangle-inner"),t=0;t<e.length;t++)e[t].style.backgroundColor=config.widget_color;if("offline"==config.chat_mode)for(var e=getElementsByClassName("jivo-bottom-left-square"),t=0;t<e.length;t++)e[t].style.backgroundColor=config.widget_color;if(this._containerDiv){if(this._textContainer.style.fontSize=config.font_size+"px",this._textContainer.style.fontFamily=config.font_family,this._isDarkText="dark"==config.widget_font_color,this._isDarkText)var i="#222222";else var i="#F0F1F1";this._textContainer.style.color=i}},setOffline:function(){document.getElementById("jivo_chat_widget_online").setAttribute("id","jivo_chat_widget_offline"),this.setText(config.offline_widget_label)},setPosition:function(){var e=getElementPosition(this._el),t=30,i=10;switch(config.widget_orientation){case"left":case"right":var n=document.getElementById("jivo-text-container"),o=n.getElementsByTagName("div")[0];switch(o.offsetWidth<o.offsetHeight?(n.style.width=o.offsetWidth+"px",n.style.height=o.offsetHeight+"px"):(n.style.width=o.offsetHeight+"px",n.style.height=o.offsetWidth+"px"),e=getElementPosition(this._el),config.widget_padding){case"0":t=-30;break;case"50":t=e.height/2;break;case"100":t=e.height+i}this._el.style.top=config.widget_padding+"%",this._el.style.marginTop=-1*t+"px",this._el.style.width=config.widget_height+"px";break;case"top":case"bottom":switch(config.widget_padding){case"0":t=-30;break;case"50":t=e.width/2;break;case"100":t=e.width+i}"100"==config.widget_padding?(this._el.style.left="",this._el.style.right="30px"):(this._el.style.left=config.widget_padding+"%",this._el.style.right="",this._el.style.marginLeft=-1*t+"px"),this._el.style.height=config.widget_height+"px"}},setFontStyle:function(){var e=document.getElementById("jivo-label-text");switch(config.font_type){case"normal":e.style.fontWeight="normal",e.style.fontStyle="normal";break;case"italic":e.style.fontWeight="normal",e.style.fontStyle="italic";break;case"bold":e.style.fontWeight="bold",e.style.fontStyle="normal";break;case"bold italic":e.style.fontWeight="bold",e.style.fontStyle="italic"}e.style.fontSize=config.font_size},getPosition:function(){return getElementPosition(document.getElementById("jivo-label"))}}),JivoChatTop=TimeMachine.extend({namespace:"CHAT",mode:"online",_scrollOffset:0,_manualyScrolled:0,_chatDiv:0,_iframe:0,_iframeWrap:0,_doc:0,_window:0,_backgroundColor:0,_borderColor:0,_bodyColor:0,_onload_semaphore:!1,_event_queue:[],_guiState:null,_getDoc:function(){return this._iframe.contentDocument?this._iframe.contentDocument:this._iframe.contentWindow?this._iframe.contentWindow.document:(log("WARNING! chat_iframe._doc is null"),0)},iframeLoaded:function(e){if(this._onload_semaphore){removeEvent(window,"scroll",this._onWindowScroll);try{this._window.chat_contents.init(this.mode,this.open_params,jivo.isClicked),jivo.isClicked=!1}catch(e){return void log("CHAT: iframe loaded, but contents is unreachable")}this.handle("iframe_ready")}else this._onload_semaphore=!0;devicejs.chrome()&&(document.body.scrollTop=this._manualyScrolled||this._scrollOffset)},_onWindowScroll:null,setColor:function(){this._isDarkText="dark"==config.widget_font_color,this._backgroundColor=config.widget_color,this._borderColor=adjustLightness(this._backgroundColor,.6,1),this._bodyColor=adjustLightness(this._backgroundColor,1.15,.5);

var e=document.getElementById("jivo-chat");if(e){var t,i;this._isDarkText?(t=adjustLightness(this._backgroundColor,1.15,.7)+" 0 1px",i=adjustLightness(this._backgroundColor,.1,.5)):(t=adjustLightness(this._backgroundColor,.6,1)+" 0 -1px",i="#ffffff"),document.getElementById("jivo-loader-title").style.color=i}},setChatHeight:function(e){var t=document.getElementById("jivo-chat");log("Setting chat height: "+e),jivo.transferProportion({width:t.offsetWidth,height:e}),this._chatDiv.style.height=e+"px"},hide:function(){this._iframe.style.display="none",this._iframe.style.visibility="hidden",this._chatDiv.style.visibility="hidden",removeClass(this._chatDiv,"jivo-fade-in")},show:function(){this._iframe.style.display="block",this._iframe.style.visibility="visible",this._chatDiv.style.visibility="visible",addClass(this._chatDiv,"jivo-fade-in")},getInitPosition:function(){var e={},t="top"==config.widget_orientation||"bottom"==config.widget_orientation;return"left"==config.widget_orientation||t&&0==config.widget_padding?e.left="30px":e.right="30px","online"===config.chat_mode?(cookie("left")&&(e.left=cookie("left")),cookie("right")&&(e.right=cookie("right")),cookie("height")?e.height=cookie("height"):1==config.contacts_ask&&(e.height=this.getOnlineFormHeight())):e.height=this.getOfflineFormHeight(),jivo.isTablet()&&!jivo.isSeparateWindow()&&(e.height=350),e},getOfflineFormHeight:function(){var e=this.getOfflineDescriptionHeight();return e+=JivoChatTop.MESSAGE_OFFLINE_HEIGHT+JivoChatTop.INPUT_MARGIN,!config.contacts_settings.email.show&&config.contacts_settings.phone.show&&config.contacts_settings.phone.required||(e+=JivoChatTop.INPUT_HEIGTH+JivoChatTop.INPUT_MARGIN),config.contacts_settings.name.show&&(e+=JivoChatTop.INPUT_HEIGTH+JivoChatTop.INPUT_MARGIN),config.contacts_settings.phone.show&&(e+=JivoChatTop.INPUT_HEIGTH+JivoChatTop.INPUT_MARGIN),8&config.options&&config.hide_ad||(e+=JivoChatTop.ADWORD_HEIGHT),e+=2*JivoChatTop.INNER_PADDING,e+=JivoChatTop.HEADER_OFFLINE_HEIGHT,e+=JivoChatTop.BUTTONS_HEIGHT,e+"px"},getOfflineDescriptionHeight:function(){var e,t=document.createElement("div");return t.style.position="absolute",t.style.fontSize="16px",t.style.fontFamily="Arial, sans-serif",t.style.lineHeight="19px",t.style.visibility="hidden",t.style.width="247px",t.innerHTML=config.offline_form_text,document.body.appendChild(t),e=t.offsetHeight+JivoChatTop.DESCRIPTION_MARGIN,document.body.removeChild(t),e},getOnlineFormHeight:function(){var e=JivoChatTop.MESSAGE_ONLINE_HEIGHT+JivoChatTop.INPUT_MARGIN;return config.contacts_settings.email.show&&(e+=JivoChatTop.INPUT_HEIGTH+JivoChatTop.INPUT_MARGIN),e+=JivoChatTop.INPUT_HEIGTH+JivoChatTop.INPUT_MARGIN,config.contacts_settings.phone.show&&(e+=JivoChatTop.INPUT_HEIGTH+JivoChatTop.INPUT_MARGIN),config.departments&&(e+=JivoChatTop.INPUT_HEIGTH+JivoChatTop.INPUT_MARGIN),8&config.options&&config.hide_ad||(e+=JivoChatTop.ADWORD_HEIGHT),e+=JivoChatTop.INNER_PADDING,e+=JivoChatTop.HEADER_ONLINE_HEIGHT,e+=JivoChatTop.BUTTONS_HEIGHT,e+=JivoChatTop.AVATAR_MARGIN,Math.max(JivoChatTop.MIN_HEIGHT,e)+"px"},getPosition:function(){return getElementPosition(this._chatDiv)},getGuiState:function(){this._guiState=cookie("gui_state")},initialize:function(){this._onWindowScroll=underscore.bind(function(){this._manualyScrolled=document.body.scrollTop},this);var e,t,i;this._chatDiv=document.createElement("div"),this._chatDiv.setAttribute("id","jivo-chat");var n=this.getInitPosition();for(t in n)this._chatDiv.style[t]=n[t];for(e="mobile",this._chatDiv.innerHTML=_templates.chat({chatMode:config.chat_mode,mobile:"desktop",lblLookingForFreeAgent:translate("lblLookingForFreeAgent")}),this.topWrap.appendChild(this._chatDiv),this.setColor(),i=getElementsByClassName("jivo-chat-triangle"),t=0;t<i.length;t++)i[t].style.borderLeftColor=config.widget_color;for(i=getElementsByClassName("jivo-triangle-inner"),t=0;t<i.length;t++)i[t].style.backgroundColor=config.widget_color;if("offline"==config.chat_mode)for(i=getElementsByClassName("jivo-bottom-left-square"),t=0;t<i.length;t++)i[t].style.backgroundColor=config.widget_color},states:{uninitialized:{show:function(e,t){this.getGuiState(),this.mode=e,this.open_params=t,this.transition("LOADING_IFRAME")},resume_ok:function(){this.getGuiState(),this._event_queue.push(["resume_ok"].concat(underscore.toArray(arguments))),this.mode="online",this.transition("LOADING_IFRAME")},invitation:function(e,t){this.getGuiState(),this._event_queue.push(["accept",{agent_info:e}]),this._event_queue.push(["agent_message",{message:t}]),this.mode="online",this.transition("LOADING_IFRAME")}},LOADING_IFRAME:{_onEnter:function(){this._scrollOffset=document.body.scrollTop||0,addListener(window,"scroll",this._onWindowScroll),"CHAT"===this._guiState&&(this._chatDiv.style.visibility="visible",addClass(this._chatDiv,"jivo-fade-in")),this._iframe=document.createElement("iframe"),this._iframe.setAttribute("id","jivo_chat_iframe"),this._iframe.setAttribute("frameBorder","0"),this._iframe.setAttribute("scrolling","no"),this._iframe.allowTransparency=!0,this._iframe.style.visibility="hidden",this._iframeWrap=document.getElementById("jivo_iframe_placeholder"),this._iframeWrap.appendChild(this._iframe),setIframeLoadCallback(this._iframe,underscore.bind(this.iframeLoaded,this)),this._doc=this._getDoc(),this._doc.open();var e={title:window.document.title,lblPhoneHint:translate("lblPhoneHint")};this._doc.write(_templates.content(e)),this._doc.close(),this._window=this._iframe.contentWindow,this.iframeLoaded(),addClass(this._chatDiv,"jivo-animated jivo-"+config.chat_mode)},iframe_ready:function(){delete this.open_params,jivo.gui.animationIsSupported()?(addClass(document.getElementById("jivo-loader"),"jivo-fade-out"),addClass(this._iframe,"jivo-fade-in")):document.getElementById("jivo-loader").style.display="none";for(var e=0;e<this._event_queue.length;e++){var t=this._event_queue[e];this._window.chat_contents.handle.apply(this._window.chat_contents,t)}this._event_queue=[],this.transition("CHAT"===this._guiState?"VISIBLE":"HIDDEN")},update_height:function(e){this.setChatHeight(e)},"*":function(){this._event_queue.push(underscore.toArray(arguments)),this.mode="online"},invitation:function(e,t){this._event_queue.push(["accept",{agent_info:e}]),this._event_queue.push(["agent_message",{message:t}]),this.mode="online"}},VISIBLE:{_onEnter:function(){var e=document.getElementById("jivo-chat");jivo.transferProportion({width:e.offsetWidth,height:e.offsetHeight}),this.show()},hide:function(){this.transition("HIDDEN")},update_height:function(e){this.setChatHeight(e)},"*":function(){this._window.chat_contents.handle.apply(this._window.chat_contents,underscore.toArray(arguments))},invitation:function(e,t){this._window.chat_contents.handle("accept",{agent_info:e}),this._window.chat_contents.handle("agent_message",{message:t})}},HIDDEN:{_onEnter:function(){this.hide()},show:function(e,t){this.transition("VISIBLE"),this._window.chat_contents.handle(jivo.isClicked?"focus_maximize":"maximize",t||e),jivo.isClicked=!1},invitation:function(e,t){this._window.chat_contents.handle("accept",{agent_info:e}),this._window.chat_contents.handle("agent_message",{message:t}),this.transition("VISIBLE")},"*":function(){this._window.chat_contents.handle.apply(this._window.chat_contents,underscore.toArray(arguments))}}}},{INPUT_MARGIN:10,INPUT_HEIGTH:30,MESSAGE_OFFLINE_HEIGHT:109,BUTTONS_HEIGHT:28,HEADER_OFFLINE_HEIGHT:60,INNER_PADDING:10,ADWORD_HEIGHT:30,MESSAGE_ONLINE_HEIGHT:84,HEADER_ONLINE_HEIGHT:75,AVATAR_MARGIN:20,MIN_HEIGHT:372,DESCRIPTION_MARGIN:20}),JivoGui=TimeMachine.extend({namespace:"GUI",mode:"online",animate:!1,unreadMessages:0,setCookie:!0,_event_queue:[],setOnline:function(){return this.mode="online",this},setOffline:function(){return"offline"!=this.mode&&(this._setButtonsOffline(),this.widget.setOffline(),this.mode="offline"),this},showWidget:function(e,t){return this.enableAnimation(!!e),this.setCookie=void 0==t?!0:!!t,this.handle("minimize"),this},showChat:function(e,t){return jivo.isMobileOrTablet()?this.openNewWindow():(this.enableAnimation(!!e),this.handle("maximize",t)),this},showInvitation:function(e,t){return this.handle("invitation",e,t),this},openNewWindow:function(){var e,t=window.location.protocol,i=t+jivo_config.base_url+"/script/window/"+jivo_config.widget_id,n=[],o=["client_id"];"online"===jivo_config.chat_mode&&o.push("sess_id");for(var s=0;s<o.length;s++)cookie(o[s])&&n.push(o[s]+"="+cookie(o[s]));e=jivo.getCurrentPage(),n.push("url="+encodeURIComponent(e.url)),n.push("title="+encodeURIComponent(e.title)),n.length&&(i+="?"+n.join("&"));var r;jivo.isTablet()&&jivo.checkVisibilityAPI?r=window.open(i,"jivo_"+config.widget_id):window.location=i,r&&r.focus()},getChatTop:function(){return this.chat_top||(this.chat_top=new JivoChatTop({topWrap:this._wrapDiv})),this.chat_top},chatInitialized:function(){return!!this.chat_top},incrementCounter:function(){var e=document.getElementById("jivo-label-indicator");e.innerHTML=++this.unreadMessages,e.style.visibility="visible"},resetCounter:function(){var e=document.getElementById("jivo-label-indicator");this.unreadMessages=0,e.style.visibility="hidden"},_setButtonsOffline:function(){for(var e=!1,t=getElementsByClassName("jivo-btn jivo-online-btn"),i=0;i<t.length;i++)e||(e=t[i].style.display),t[i].style.display="none";for(t=getElementsByClassName("jivo-btn jivo-offline-btn"),i=0;i<t.length;i++)t[i].style.display=e},highlight:function(e){var t=config.base_url+"/script/cobrowsing?cb=?&hash="+e;getJSONP(t,function(e){underscore.isObject(e)&&(0==e.comment.length&&(e.comment=translate("lblDefaultCobrowseComment")),e.comment=stripBrackets(e.comment),childSandboxBridge.process("highlight",e),childSandboxBridge.process("renderTooltip",e))})},initialize:function(){this._wrapDiv=document.createElement("div"),this._wrapDiv.setAttribute("id","jivo_top_wrap"),document.body.appendChild(this._wrapDiv),underscore.defaults(config,{online_widget_label:translate("defOnlineWidgetLabel"),offline_widget_label:translate("defOfflineWidgetLabel"),offline_form_text:translate("defOfflineFormText"),contacts_settings:{name:{show:!1,required:!1},phone:{show:!1,required:!1},email:{show:!1,required:!1}}}),getConfigContactsAsk(),jivo.isMobile()&&(config.online_widget_label=translate("defOnlineWidgetLabelMobile")||config.online_widget_label,config.offline_widget_label=translate("defOfflineWidgetLabelMobile")||config.offline_widget_label,config.widget_orientation="bottom",config.widget_padding=100,config.ignore_viewport&&(jivo.ignore_viewport=config.ignore_viewport)),jivo.isWixIframe()&&(config.widget_orientation="bottom"),this.widget=new JivoWidget({topWrap:this._wrapDiv}),this.copyright=new JivoCopyright,this.animationIsSupported()&&(this.phantom=new JivoPhantom({topWrap:this._wrapDiv}),this.phantom.on("animated",underscore.bind(this.handle,this,"animate_finished")))},enableAnimation:function(e){!jivo.isWixIframe()&&e?(log("GUI : enabling animation"),this.animate=!0):(log("GUI : disabling animation"),this.animate=!1)},animationIsSupported:function(){return!(this.widget.isCustom()||!css3AnimationIsSupported())},states:{uninitialized:{minimize:"WIDGET",maximize:function(){this._event_queue.push(["show",this.mode]),this.transition("CHAT")},blacklist:"INVISIBLE",resume_ok:function(e){var t,i=e.client_info.msg_history;for(this.getChatTop().handle.apply(this.getChatTop(),["resume_ok"].concat(underscore.toArray(arguments))),t=0;t<i.length;t++)if("agentMessage"===i[t].type&&0===i[t].ack)return void this.transition("CHAT");this.transition(cookie("gui_state")&&"CHAT"===cookie("gui_state")?"CHAT":"WIDGET")}},WIDGET:{_onEnter:function(){this.setCookie&&cookie("gui_state","WIDGET"),jivo.updateClient({chat_opened:!1}),this.chatInitialized()&&this.getChatTop().handle("hide"),this.widget.handle("show")},maximize:function(e){this.resetCounter(),this._event_queue.push(["show",this.mode,e]),this.transition(this.animationIsSupported()&&this.animate?"ANIMATE_EXPAND":"CHAT")},"*":function(e){jivo.isMobile()||jivo.isAndroid4old()&&jivo.isTablet()?underscore.indexOf(["agent_message","system_message","invitation","agent_service_message"],e)>=0&&underscore.indexOf(["agent_message","invitation","agent_service_message"],e)>=0&&this.incrementCounter():("invitation"!==e&&this._event_queue.push(["show",this.mode]),this._event_queue.push(underscore.toArray(arguments)),underscore.indexOf(["agent_message","invitation","agent_service_message"],e)>=0?this.transition(this.animationIsSupported()?"ANIMATE_EXPAND":"CHAT"):"resume_ok"===e&&this.transition("CHAT"))},blacklist:function(){this.widget.handle("hide"),this.transition("INVISIBLE")}},CHAT:{_onEnter:function(){this.setCookie&&cookie("gui_state","CHAT"),jivo.updateClient({chat_opened:!0}),this.widget.handle("hide");var e;for(jivo.transferProportion({width:this.getChatTop().getPosition().width,height:this.getChatTop().getPosition().height});e=this._event_queue.shift();)this.getChatTop().handle.apply(this.getChatTop(),e);this.widget.fade||(this.widget.fade=!0)},minimize:function(){this.transition(this.animationIsSupported()&&this.animate?"ANIMATE_COLLAPSE":"WIDGET")},"*":function(){this.getChatTop().handle.apply(this.getChatTop(),underscore.toArray(arguments))},blacklist:function(){this.getChatTop().handle("hide")}},ANIMATE_EXPAND:{_onEnter:function(){jivo.transferProportion({width:this.getChatTop().getPosition().width,height:this.getChatTop().getPosition().height}),this.phantom.handle("expand",this.widget.getPosition(),this.getChatTop().getPosition()),this.widget.handle("hide")},animate_finished:"CHAT",resume_ok:function(){this.getChatTop().handle.apply(this.getChatTop(),["resume_ok"].concat(underscore.toArray(arguments)))},agent_message:function(e){this._event_queue.push(["agent_message",e])},blacklist:"INVISIBLE"},ANIMATE_COLLAPSE:{_onEnter:function(){jivo.transferProportion({width:this.widget.getPosition().width,height:this.widget.getPosition().height}),this.phantom.handle("collapse",this.widget.getPosition(),this.getChatTop().getPosition()),this.getChatTop().hide()},agent_message:function(e){this._event_queue.push(["agent_message",e])},animate_finished:"WIDGET",blacklist:"INVISIBLE"},INVISIBLE:{animate_finished:function(){this.widget.handle("hide"),this.getChatTop().handle("hide")}}}}),JivoCopyright=TimeMachine.extend({namespace:"AD",initialState:"HIDDEN",disabled:!1,initialize:function(){var e=document.getElementById("jivo-label-copyright");if(!utils.showAd())return addClass(e,"jivo-no-copyright"),void(this.disabled=!0);if(this.jivo_copyright=document.getElementById("jivo_copyright"),!this.jivo_copyright){this.jivo_copyright=document.createElement("div");var t="en"===config.iconLocale?"com":"ru";this.jivo_copyright.innerHTML=translate("seo_copyrightTextNew").replace("_JIVOSITE_","<a href='http://jivo"+("en"===config.iconLocale?"chat.":"site.")+t+"' target='_blank' id='jivosite-copyright' class='jivo-"+config.widget_font_color+" jivo-"+config.iconLocale+"'></a>"),this.jivo_copyright.id="jivo_copyright",this.jivo_copyright.style.display="none",document.body.appendChild(this.jivo_copyright)}var i=document.createElement("div");switch(i.setAttribute("id","jivo_copyright_corner"),i.setAttribute("class","jivo-"+config.widget_orientation),config.widget_orientation){case"top":i.style.borderBottomColor=config.widget_color;break;case"left":i.style.borderRightColor=config.widget_color;break;case"right":i.style.borderLeftColor=config.widget_color;break;case"bottom":i.style.borderTopColor=config.widget_color}this.jivo_copyright.style.backgroundColor=config.widget_color,this.jivo_copyright.appendChild(i);for(var n=this.jivo_copyright.getElementsByTagName("a"),o=0;o<n.length;o++)n[o].href+="?utm_source="+encodeURIComponent(location.hostname)+"&utm_medium=link&utm_content=widget_popup&utm_campaign=self_ad";jivo.isMobile()||(e.onmouseover=underscore.bind(this.handle,this,"ad_mouseover"),e.onmouseout=underscore.bind(this.handle,this,"ad_mouseout"),this.jivo_copyright.onmouseover=underscore.bind(this.handle,this,"copyright_mouseover"),this.jivo_copyright.onmouseout=underscore.bind(this.handle,this,"copyright_mouseout"))},getTooltipPosition:function(e){var t=getElementPosition(e),i=getElementPosition(document.getElementById("jivo_copyright")),n={top:0,left:0};switch(config.widget_orientation){case"left":n={top:t.top+20,left:t.left+t.width+10},ie8&&(n={top:t.top,left:t.left+t.width+10});break;case"right":n={top:t.top+20,left:t.left-i.width-10};break;case"top":n={top:t.top+(t.height+15),left:t.left+40};break;case"bottom":n={bottom:t.height+10,left:t.left+(t.width-i.width)-40}}return n},states:{HIDDEN:{_onEnter:function(){this.disabled||(this.jivo_copyright.style.display="none")},ad_mouseover:"VISIBLE"},VISIBLE:{_onEnter:function(){this.jivo_copyright.style.display="block";var e=this.getTooltipPosition(document.getElementById("jivo-label"));this.jivo_copyright.style.left=e.left+"px","undefined"!=typeof e.bottom?this.jivo_copyright.style.bottom=e.bottom+"px":this.jivo_copyright.style.top=e.top+"px"},ad_mouseout:function(){this._scheduleEvent("hide",700)},hide:"HIDDEN",copyright_mouseover:function(){this._cancelEvent("hide")},copyright_mouseout:function(){this._scheduleEvent("hide",700)}}}}),jivoTitle=new TimeMachine({namespace:"TITLE",title:"",startBlink:function(){this.handle("start")},stopBlink:function(){this.handle("stop")},_messageShown:!1,_showMessage:function(){document.title=translate("lblNewMessage"),this._messageShown=!0},_showTitle:function(){document.title=this.title,this._messageShown=!1},states:{uninitialized:{start:"blinking"},blinking:{_onEnter:function(){this.title=document.title,this._showMessage(),this._scheduleEvent("blink",1e3)},blink:function(){this._messageShown?this._showTitle():this._showMessage(),this._scheduleEvent("blink",1e3)},stop:function(){this._showTitle(),this._cancelEvent("blink"),this.transition("uninitialized")}}}}),jivo=window.jivo=new TimeMachine({namespace:"JIVO",_chatWindow:!1,_forcedCurrentPage:!1,_forcedOffline:!1,checkVisibilityAPI:!0,invitationText:!1,agentInfo:!1,ruleName:!1,isClicked:!1,initialize:function(){var e=underscore.bind(this.handle,this,"window.loaded");if(window.parentSandboxBridge&&window.parentSandboxBridge.inAir)var t=setInterval(function(){log("check for document.readyState: "+document.readyState),("complete"===document.readyState||"loaded"===document.readyState)&&(jivo.handle("window.loaded"),clearInterval(t))},300);else"complete"===document.readyState?setTimeout(e):document.addEventListener?(document.addEventListener("DOMContentLoaded",e,!1),window.addEventListener("load",e,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",e),window.attachEvent("onload",e)),this.device=devicejs},_changeBrowserLocation:function(e,t){"function"==typeof window.parent.history.pushState&&window.parent.history.pushState({},t,e)},_newSession:function(){if(cookie("sess_id",null),!this.isSeparateWindow()){if("offline"===config.chat_mode&&utils.hideOffline())return void this.transition("HIDDEN");if(16&config.options)return void this.transition("INIT_RULE_MANAGER");"online"===config.chat_mode?(this.isVisitorsInsight()&&connection.handle("startup"),this.transition("ONLINE")):this.transition("OFFLINE")}this.gui.showWidget()},_listenMessages:function(e){log("JIVO: listening for window messages"),"addEventListener"in window?window.addEventListener("message",underscore.bind(this._windowMessage,this,e),!1):"attachEvent"in window&&window.attachEvent("message",underscore.bind(this._windowMessage,this,e))},_windowMessage:function(e,t){this.handle([e,t.data.action].join("_"),t)},isVisitorsInsight:function(){return 1===config.visitors_insight},isMobile:function(){return devicejs.mobile()},isTablet:function(){return devicejs.tablet()},isMobileOrTablet:function(){return this.isMobile()||this.isTablet()},isAndroid4old:function(){var e,t=navigator.userAgent,i=!1;return t.indexOf("Android")>=0&&(e=parseFloat(t.slice(t.indexOf("Android")+8)),(4===e||4.1===e||4.2===e)&&(i=!0)),i},isWixIframe:function(){return"undefined"!=typeof jivo_in_wix_iframe},isSeparateWindow:function(){return"undefined"!=typeof jivo_newWindow},createMagicIFrame:function(){this.isMobile()||this.isTablet()||this.isSeparateWindow()||jivo.isWixIframe()||site_iframe.create()},_callUserFunction:function(e,t){if(e="jivo_"+e,"function"==typeof window[e])try{log("JIVO: calling user function "+e),window[e](t),log("JIVO: user function "+e+" returned")}catch(i){}},_sendIntroduce:function(e){connection.sendIfConnected({name:"introduction",client_name:e.name,phone:e.phone,email:e.email}),this._saveClientInfo(e)},_saveClientInfo:function(e){underscore.each(["name","phone","email"],function(t){t in e&&""!==e[t]&&("name"===t?cookie("client_name",e[t],{expires:365,path:"/"}):cookie(t,e[t],{expires:365,path:"/"}))})},_chatAccepted:function(){analytics.trackChatConnected(),this._callUserFunction("onAccepted")},transferProportion:function(e){this._callUserFunction("onResizeCallback",e)},getCurrentPage:function(){return this._forcedCurrentPage?this._forcedCurrentPage:{url:window.location.href,title:document.title}},getChatHeight:function(){return document.getElementById("jivo-chat").offsetHeight},_stripHashFromLocation:function(e){window.location.href.indexOf("#jvhs_"+e)>0&&this._changeBrowserLocation(window.location.href.replace("#jvhs_"+e,""),document.title)},_pageVisible:function(){return"visibilityState"in document?"visible"===document.visibilityState:"webkitVisibilityState"in document?"visible"===document.webkitVisibilityState:!1},_listenVisibility:function(){log("Installing visibility event handler");var e,t,i;"undefined"!=typeof document.hidden?(e="hidden",i="visibilitychange",t="visibilityState"):"undefined"!=typeof document.mozHidden?(e="mozHidden",i="mozvisibilitychange",t="mozVisibilityState"):"undefined"!=typeof document.msHidden?(e="msHidden",i="msvisibilitychange",t="msVisibilityState"):"undefined"!=typeof document.webkitHidden&&(e="webkitHidden",i="webkitvisibilitychange",t="webkitVisibilityState"),"addEventListener"in document&&"undefined"!=typeof i?document.addEventListener(i,underscore.bind(this._visibleHandler,this,t),!1):this.checkVisibilityAPI=!1},_visibleHandler:function(e){this.handle("window_"+document[e]),this.updateClient({page_visible:this._pageVisible()})},_isBlacklisted:function(){var e=cookie("client_id");return e&&0===e.indexOf("z")},_inAir:function(){return window.parentSandboxBridge&&window.parentSandboxBridge.inAir},_sendRate:function(e,t){var i={jv_sess_id:t,r:e};getJSONPWithData(config.base_url+"/script/rate/"+config.widget_id,i,function(e){log("Rate result",e)})},handleGuiTransition:function(e){"WIDGET"===e.toState?this._callUserFunction("onClose"):"CHAT"===e.toState&&this._callUserFunction("onOpen")},updateClient:function(e){var t={name:"update_client"};underscore.extend(t,e),connection.updateClient(t)},"*":function(e){return"update_height"===e?void this.gui.handle.apply(this.gui,underscore.toArray(arguments)):void log(this.namespace+": unhandled "+e+" in state "+this.state)},states:{uninitialized:{"window.loaded":function(){if(!cookie("enter_ts")){cookie("enter_ts",(new Date).getTime()),document.referrer&&(cookie("refer",document.referrer),setUTMParams(window.location.href));var e=cookie("visits_count")-0;cookie("visits_count",e?e+1:1,{expires:365,path:"/"})}if(this.isSeparateWindow()){this._listenVisibility();var t=getURLParam("url"),i=getURLParam("title");t&&i&&(this._forcedCurrentPage={url:t,title:i});var n=getURLParam("client_id");n&&cookie("client_id",n);var o=getURLParam("sess_id");config.chat_mode=o?"online":"offline",this.gui=new JivoGui,o?(cookie("sess_id",o,{expires:1,path:"/"}),this.transition("CHECKING_SESSION")):this.transition("OFFLINE")}else this.transition(this._isBlacklisted()||this.isMobileOrTablet()&&config.disable_mobile?"HIDDEN":"LOADING_CSS")}},LOADING_CSS:{_onEnter:function(){if(document.createStyleSheet)ie&&document.createStyleSheet(staticUrl("/css/label.css")),ie8&&document.createStyleSheet(staticUrl("/css/label-ie8.css"));else{var e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("href",staticUrl("/css/label.css"));var t=utils.browser;if("Opera"===t.name||"Safari"===t.name&&t.mV<6||"Firefox"===t.name&&t.mV<12){var i=document.createElement("link");i.setAttribute("rel","stylesheet"),i.setAttribute("href",staticUrl("/css/label-ie8.css")),document.body.appendChild(i)}document.body.appendChild(e)}var n=this.cssDetector=document.createElement("div");n.id="jivo_css_detector",n.style.visibility="hidden",n.style.position="absolute",document.body.appendChild(n),this._scheduleEvent("timer_css",100)},timer_css:function(){if(!(this.cssDetector.offsetWidth>0))return void this._scheduleEvent("timer_css",100);this.gui=new JivoGui;try{if(this._inAir())return window.parentSandboxBridge.process("onIframeDomReady"),void this.transition("HIDDEN")}catch(e){}this.gui.on("transition",underscore.bind(this.handleGuiTransition,this));var t=window.location.hash.split("jvhs_");if(underscore.isUndefined(t[1])||this.gui.highlight(t[1]),window!=window.top){try{if(window.top.jivo_magic_var===jivo_magic_var&&!this.isWixIframe())return this.transition("IN_IFRAME"),void this._callUserFunction("onLoadCallback")}catch(e){}if(!this.isWixIframe())return void this.transition("HIDDEN")}this.isSeparateWindow()||(this._listenVisibility(),this._callUserFunction("onLoadCallback")),cookie("sess_id")?this.transition("CHECKING_SESSION"):this._newSession()},gui_introduced:function(e){this._saveClientInfo(e)}},CHECKING_SESSION:{_onEnter:function(){var e=cookie("sess_id"),t=this.getCurrentPage();getJSONPWithData(chatserverUrl(e,config.site_id,config.widget_id),{name:"url_change",jv_widget_id:config.widget_id,title:t.title,url:t.url},underscore.bind(this.handle,this,"check_session_response")),this._scheduleEvent("timer_check_session",2e3)},check_session_response:function(e){return log("JIVO: Check session response",e),this._cancelEvent("timer_check_session"),"object"==typeof e&&"ok"===e.result?void(e.has_connection?this._pageVisible()?this.transition("RESUMING"):(this.transition("ONLINE"),this.gui.showWidget()):this.transition("RESUMING")):void this._newSession()},timer_check_session:function(){this._newSession()}},RESUMING:{_onEnter:function(){connection.resume(cookie("sess_id"))},resume_ok:function(e){var t,i,n=e.client_info.msg_history;if(n)for(t=0;t<n.length;t++)if("clientMessage"===n[t].type){this.createMagicIFrame();break}if(this.transition("ONLINE"),!this.isMobileOrTablet()||this.isSeparateWindow())this.isSeparateWindow()||!this.isVisitorsInsight()||!n||0!==n.length||e.agent_info?this.gui.handle("resume_ok",e):(cookie("invitation_time",""),this.transition("INIT_RULE_MANAGER"));else{for(this.gui.showWidget(),t=0;t<n.length;t++)"agentMessage"===n[t].type&&0===n[t].ack&&(this.gui.incrementCounter(),i=!0);i||this.gui.resetCounter()}},resume_failed:function(){this._newSession()}},HIDDEN:{},IN_IFRAME:{_onEnter:function(){cookie("mframe",null),window.parent.jivo.handle("iframe_url_change",window.location.href,document.title)},highlight_cobrowse:function(e){this.gui.highlight(e)},"*":function(e){underscore.indexOf(["api_open","gui_close_cobrowse"],e)>=0?window.parent.jivo.handle.apply(window.parent.jivo,underscore.toArray(arguments)):log("JIVO: unhandled "+e+" in "+this.state)}},INIT_RULE_MANAGER:{_onEnter:function(){ruleManager.isInited?this.handle("rule_manager_ready"):(ruleManager.on("ready",underscore.bind(this.handle,this,"rule_manager_ready")),ruleManager.init())},rule_manager_ready:function(){"online"===config.chat_mode?(this.isVisitorsInsight()&&connection.handle("startup"),this.transition("ONLINE")):this.transition("OFFLINE"),this.gui.showWidget()},hide:"HIDDEN"},ONLINE:{_onEnter:function(){this.gui.setOnline()},api_open:function(e){this.handle("gui_maximize",e)},invitation:function(e,t){return t?(this.updateClient({chat_opened:!0,page_visible:this._pageVisible(),proactive_rule:{invitation_text:e.invitationText,agent_id:t.agent_id}}),analytics.trackProactiveInvitationShown(e.name),this.ruleName=e.name,this.invitationText=e.invitationText,this.agentInfo=t,this.gui.showInvitation(this.agentInfo,this.invitationText),void this.transition("PROACTIVE")):void log("JIVO: invitation failed, no agent")},highlight_cobrowse:function(e){this.gui.highlight(e)},gui_close_cobrowse:function(e){this._stripHashFromLocation(e)},gui_maximize:function(e){this.openParams=e,this.isMobileOrTablet()&&!cookie("sess_id")?this.transition("STARTING_SESSION"):(analytics.trackChatOpenedByClick(),this.gui.showChat(!0,this.openParams))},gui_answer_proactive:function(){cookie("sess_id")&&this.gui.showChat(!0,this.openParams)},gui_typing:function(e){connection.sendIfConnected({name:"client_typing",typing:e})},gui_introduced:function(e,t){this._sendIntroduce(e),t||(analytics.trackGaveContacts(),this._callUserFunction("onIntroduction"))},gui_message:function(e){this.createMagicIFrame();var t={name:"client_message",message:e};this.department_id&&(t.widget_department_id=this.department_id,this.department_id=null),connection.send(t),this.gui.handle("gui_message",e)},gui_department:function(e){this.department_id=e},gui_typing_insight:function(e){connection.sendIfConnected({name:"client_service_message",service:"typing_insight",event:"input_changed",new_val:e})},gui_minimize:function(){jivoTitle.stopBlink(),this.gui.showWidget(!0)},gui_decline_file:function(e,t){jivoTitle.stopBlink(),connection.send({name:"client_service_message",service:"file_transfer",file_id:e,file_name:t,event:"file_declined"})},gui_receive_file:function(e,t){jivoTitle.stopBlink(),connection.send({name:"client_service_message",service:"file_transfer",file_id:e,file_name:t,event:"file_received"})},gui_accept_cobrowse:function(e,t){jivoTitle.stopBlink();var i=document.location.href.split("#")[0],n=e+"#jvhs_"+t,o=document.getElementById("jivo_magic_iframe");if(i===e||i===encodeURI(e)){try{var s=window;o&&(s=o.contentWindow),s.jivo.handle("highlight_cobrowse",t)}catch(r){return void log(r.toString())}this._changeBrowserLocation(n,document.title)}else jivo.isMobileOrTablet()?window.open(n,document.title):o?site_iframe.navigate(n):document.location.href=n},gui_evaluation:function(e,t){this._sendRate(e,t)},agent_chat_close:function(){this.invitationText=this.agentInfo=!1,this.gui.handle("agent_chat_close")},gui_msg_input_focus:function(){jivoTitle.stopBlink()},"*":function(e,t){underscore.indexOf(["agent_message","agent_service_message","system_message","agent_typing","accept","agent_chat_close","gui_resume","update_height","transferred","update_agent_info","blacklist"],e)>=0?(this.gui.handle.apply(this.gui,underscore.toArray(arguments)),underscore.indexOf(["agent_message","agent_service_message"],e)>=0&&(jivoTitle.startBlink(),this.isVisitorsInsight()&&t.msg_id&&1===t.msg_id&&!this.invitationText&&1===config.contacts_ask&&(this.invitationText=t.message)),"accept"===e&&this._chatAccepted()):log("JIVO: unhandled "+e+" in "+this.state)},iframe_url_change:function(e,t){this._changeBrowserLocation(e,t),connection.sendIfConnected({name:"url_change",url:e,title:t})},reopened_elsewhere:function(){jivoTitle.stopBlink(),this.gui.showWidget(!1,!1)},connect_failed:function(){this._forcedOffline="connect_failed",this.transition("OFFLINE"),this.gui.handle("connect_failed")},force_offline:function(e){this._forcedOffline=e.err_code?e.err_code:e.name,this.transition("OFFLINE"),this.gui.handle("connect_failed")},window_visible:function(){!connection.isConnected()&&cookie("sess_id")&&this.transition("CHECKING_SESSION")},gui_start_call:function(){connection.send({name:"request_call",want_call:1})},gui_agent_message_ack:function(e){connection.sendIfConnected({name:"agent_message_ack",ack_msg_ids:e})}},OFFLINE:{_onEnter:function(){jivoTitle.stopBlink(),this.gui.setOffline()},gui_maximize:function(){analytics.trackOfflineFormOpenedByClick(),this.gui.showChat(!0)},gui_minimize:function(){this.gui.showWidget(!0)},gui_offline_message:function(e){var t=this.getCurrentPage(),i=underscore.pick(e,"email","message","phone","name","cap_id","cap_symbols");

underscore.extend(i,{page_url:t.url,page_title:t.title}),cookie("client_id")&&(i.client_id=cookie("client_id")),cookie("__utmz")&&(i.g_utmz=cookie("__utmz")),cookie("refer")&&(i.refer=cookie("refer"),cookie("utm")&&(i.utm=cookie("utm"))),this._forcedOffline&&(i.from_online=this._forcedOffline),this.isMobile()&&(i.is_mobile=1),"string"==typeof connection.user_token&&(i.user_token=connection.user_token),this._saveClientInfo(i),getJSONPWithData(config.base_url+"/script/offline-form/"+config.widget_id,i,underscore.bind(this.handle,this,"message_response")),this.transition("OFFLINE_WAIT")},gui_leave_msg:function(){this.gui.handle("gui_leave_msg")},api_open:function(){this.handle("gui_maximize")}},OFFLINE_WAIT:{_onEnter:function(){this._scheduleEvent("message_timer",5e3)},message_response:function(e){if(this._cancelEvent("message_timer"),"object"==typeof e){if("ok"===e.result)return"client_id"in e&&cookie("client_id",e.client_id,{expires:365,path:"/"}),analytics.trackOfflineMessageSent(),this.gui.handle("offline_success"),void this.transition("OFFLINE");if("error"===e.result&&"cap_id"in e)return this.gui.handle("offline_captcha",e),void this.transition("OFFLINE")}this.gui.handle("offline_failed"),this.transition("OFFLINE")},message_timer:function(){this.gui.handle("offline_failed"),this.transition("OFFLINE")}},PROACTIVE:{gui_minimize:function(){analytics.trackProactiveInvitationRejected(this.ruleName),this.gui.showWidget(!0),this.updateClient({proactive_rule:0}),this.transition("ONLINE")},gui_message:function(e){this.createMagicIFrame(),analytics.trackProactiveInvitationAccepted(this.ruleName),cookie("agent_info",[this.agentInfo.agent_id].join("$$")),this.isMobileOrTablet()||(connection.send({name:"client_message",message:e}),this.gui.handle("gui_message",e),this.transition("ONLINE"))},gui_answer_proactive:function(){this.transition("STARTING_SESSION")},gui_maximize:function(){this.isMobileOrTablet()&&(analytics.trackProactiveInvitationAccepted(this.ruleName),this.transition("STARTING_SESSION"))},gui_introduced:function(e,t){this._sendIntroduce(e),t||(analytics.trackGaveContacts(),this._callUserFunction("onIntroduction"))},window_visible:function(){!connection.isConnected()&&cookie("sess_id")&&this.transition("CHECKING_SESSION")},api_open:function(e){this.transition("ONLINE"),this.handle("api_open",e)},accept:function(){this.transition("ONLINE"),this._chatAccepted()}},STARTING_SESSION:{_onEnter:function(){connection.handle("startup")},startup_ok:function(){this.transition("ONLINE"),this.gui.showChat(!0,this.openParams)},gui_maximize:function(e){this.gui.showChat(!0,e)}}}});"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(e){return 10>e?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var i,n,o,s,r,a=gap,c=t[e];switch(c&&"object"==typeof c&&"function"==typeof c.toJSON&&(c=c.toJSON(e)),"function"==typeof rep&&(c=rep.call(t,e,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,r=[],"[object Array]"===Object.prototype.toString.apply(c)){for(s=c.length,i=0;s>i;i+=1)r[i]=str(i,c)||"null";return o=0===r.length?"[]":gap?"[\n"+gap+r.join(",\n"+gap)+"\n"+a+"]":"["+r.join(",")+"]",gap=a,o}if(rep&&"object"==typeof rep)for(s=rep.length,i=0;s>i;i+=1)"string"==typeof rep[i]&&(n=rep[i],o=str(n,c),o&&r.push(quote(n)+(gap?": ":":")+o));else for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(o=str(n,c),o&&r.push(quote(n)+(gap?": ":":")+o));return o=0===r.length?"{}":gap?"{\n"+gap+r.join(",\n"+gap)+"\n"+a+"}":"{"+r.join(",")+"}",gap=a,o}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,i){var n;if(gap="",indent="","number"==typeof i)for(n=0;i>n;n+=1)indent+=" ";else"string"==typeof i&&(indent=i);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var i,n,o=e[t];if(o&&"object"==typeof o)for(i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n=walk(o,i),void 0!==n?o[i]=n:delete o[i]);return reviver.call(e,t,o)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(e){var t=e.setTimeout,i=e.document,n=0;e.jivoXHR=function(){function o(){try{d.parentNode.removeChild(d)}catch(e){}}function s(){u=!1,l="",o(),d=null}function r(e){try{h.onerror.call(h,e,l)}catch(t){throw new Error(e)}}function a(){this.readyState&&"complete"!==this.readyState&&"loaded"!==this.readyState||u||(this.onload=this.onreadystatechange=null,u=!0,4!==h.readyState&&r("Script failed to load ["+l+"]."),o())}function c(e){e=e||[],h.readyState=4,h.status=200,"function"==typeof h.onload&&h.onload.apply(h,e)}var l,u,d,h=null;return h={onerror:null,onload:null,readyState:0,open:function(t,i){s(),internal_callback="cb"+n++,function(t){e.jivoXHR[t]=function(){try{c.call(h,arguments)}catch(i){h.readyState=-1,r(i.message)}e.jivoXHR[t]=null}}(internal_callback),l=i.replace(/=\?/,"=jivoXHR."+internal_callback)},send:function(){t(function(){d=i.createElement("script"),d.setAttribute("type","text/javascript"),d.charset="UTF-8",d.onload=d.onreadystatechange=function(){a.call(d)},d.setAttribute("src",l),i.getElementsByTagName("head")[0].appendChild(d)},0)},abort:function(){},setRequestHeader:function(){},getResponseHeader:function(){return""},getAllResponseHeaders:function(){return[]}},s(),h}}(window),function(){"use strict";if("undefined"!=typeof module&&module.exports&&"undefined"!=typeof require)var e=require("log4js").getLogger("pushengine"),t=require("underscore"),i=require("machina")(t),n=require("xmlhttprequest").XMLHttpRequest,o=require("./time_machine"),s=require("ws"),r=!0;else{var t=underscore,i=machina,o=TimeMachine,n=XMLHttpRequest;if("undefined"!=typeof WebSocket)var s=WebSocket;var e={};t.each(["debug","warn","error","info"],function(t){e[t]=function(){var e=Array.prototype.slice.call(arguments);"string"==typeof e[0]?e[0]="CONNECTION: "+e[0]:e.unshift("CONNECTION: "),log.apply(log,e)}});var r=!1}var a=i.Fsm.extend({namespace:"CONNECTION",host:"node.jivosite.com",resource:"cometan",srv_rotate:!1,allow_fallback:!0,server_index:0,plain_port:80,secure_port:443,secure:!0,mode:"ws",open:function(){this.handle("cmd_open")},close:function(){this.handle("cmd_close")},push:function(e){this.handle("cmd_push",e)},initialState:"CLOSED",initialize:function(){this.socket=!1},wsUri:function(){var t=[],i=this.host;return this.secure?(t.push("wss:/"),this.secure_port&&(i+=":"+this.secure_port)):(t.push("ws:/"),this.plain_port&&(i+=":"+this.plain_port)),t.push(i,this.resource),e.debug("wsUri="+t.join("/")),t.join("/")},jivoOptions:function(){return t.pick(this,"secure","host","resource","plain_port","secure_port","srv_rotate")},setSocket:function(e){if(this.socket){var i=this.socket;i.onopen=i.onclose=i.onerror=i.onmessage=function(){},i=null}this.socket=e,e.onopen=t.bind(this.handle,this,"socket_open"),e.onclose=t.bind(this.handle,this,"socket_close"),e.onerror=t.bind(this.handle,this,"socket_error"),e.onmessage=t.bind(this.handle,this,"socket_message")},states:{CLOSED:{cmd_open:"OPENING",cmd_push:function(){throw new Error("Push before connect")},cmd_close:function(){e.debug("Already closed")},socket_close:function(t){e.info("Socket close",t.code,t.reason),this.emit("disconnect",t.code,t.reason)}},OPENING:{_onEnter:function(){if("ws"==this.mode){if(s){var t="plain";r&&(t={protocol:"plain"});try{this.setSocket(new s(this.wsUri(),t))}catch(i){e.error("Could not create websocket",i.message),this.allow_fallback?(e.debug("Falling back to polling"),this.mode="jivo",this.setSocket(new c(this.jivoOptions()))):(e.debug("Fallback to polling disabled"),this.transition("CLOSED"),this.emit("connect_failed",i.message))}return}e.debug("WebSocket is not supported")}this.mode="jivo",this.setSocket(new c(this.jivoOptions()))},socket_open:function(){this.transition("OPENED")},socket_error:function(t){if(e.error("Socket error!",t.message),"function"==typeof reportException&&reportException({message:t.message||"Socket error"}),"ws"==this.mode){if(this.allow_fallback)return e.debug("Falling back to polling"),this.mode="jivo",void this.setSocket(new c(this.jivoOptions()));e.info("Fallback to polling is disabled")}this.transition("CLOSED"),this.emit("connect_failed",t.message)},socket_close:function(){this.handle("socket_error",{message:"Socket closed while opening"})},connect_failed:function(e){this.transition("CLOSED"),this.emit("connect_failed",e)},cmd_push:function(){throw new Error("Push before connect")},cmd_close:function(){this.transition("CLOSED"),this.socket.close()}},OPENED:{_onEnter:function(){this.emit("connect",this.mode)},cmd_push:function(e){this.socket.send(JSON.stringify(e))},socket_message:function(e){"object"==typeof e.data?this.emit("message",e.data):this.emit("message",JSON.parse(e.data))},socket_close:function(t){e.info("Socket close",t.code,t.reason),this.emit("disconnect",t.code,t.reason),this.transition("CLOSED")},cmd_close:function(){this.socket.close(),this.transition("CLOSED")}}}}),c=i.Fsm.extend({namespace:"SOCKET",initialize:function(){if(r)this.mode="xhr";else{var e=new n;this.mode="withCredentials"in e?"xhr":"jsonp",e=null}this.pull_channel=new l({master:this}),this.push_channel=new u({master:this})},xhrObject:function(){return"xhr"==this.mode?new n:new jivoXHR},cometUrl:function(e,t){var i;"object"!=typeof t&&(t={}),t.t=(new Date).getTime();var n=this.host;if("push"==e[0]){var o=n.split(".");o.length>1&&(o[0]+="psh",n=o.join("."))}if(this.srv_rotate&&this.server_index>0){var o=n.split(".");o[0]+="-"+this.server_index,n=o.join(".")}i=this.secure?["https:/",n+":"+this.secure_port,this.resource].join("/"):["http:/",n+":"+this.plain_port,this.resource].join("/"),i+="/"+e.join("/")+"?","jsonp"==this.mode&&(i+="cb=?&");var s=[];for(var r in t)s.push(r+"="+encodeURIComponent(t[r]));return i+s.join("&")},close:function(e,t){this.handle("cmd_close",e,t)},send:function(e){this.handle("cmd_push",e)},states:{uninitialized:{_onEnter:function(){this.pull_channel.handle("open"),this.transition("CONNECTING")}},CONNECTING:{connect:function(){e.debug("Pull channel connected",this.socket_id),this.transition("OPEN")},connect_failed:function(e){"function"==typeof this.onerror&&this.onerror.call(this,e),this.transition("CLOSED")},cmd_push:function(){throw new Error("Push before connect")}},OPEN:{_onEnter:function(){this.push_channel.handle("open"),"function"==typeof this.onopen&&this.onopen.call(this)},cmd_push:function(e){this.push_channel.handle("push",e)},message:function(e){"function"==typeof this.onmessage&&this.onmessage.call(this,{data:e})},disconnect:function(e,t){this.transition("CLOSED"),"function"==typeof this.onclose&&this.onclose.call(this,{code:e,reason:t})},cmd_close:function(){this.transition("CLOSED")}},CLOSED:{_onEnter:function(){this.push_channel.handle("close")},disconnect:function(e,t){"function"==typeof this.onclose&&this.onclose.call(this,{code:e,reason:t})}}}}),l=o.extend({initialState:"CLOSED",namespace:"SOCKET-PULL",initialize:function(){},_pull:function(){this.pull_request=this.master.xhrObject(),this.pull_request.open("GET",this.master.cometUrl(["pull",this.master.socket_id])),this.pull_request.onload=t.bind(this.handle,this,"pull_load"),this.pull_request.onerror=t.bind(this.handle,this,"pull_error"),this.pull_request.send(),this._scheduleEvent("pull_timeout",this.hold_timeout),this.reconnect_state="PULL",this.transition("PULL")},_ack:function(){this.pull_request=this.master.xhrObject(),this.pull_request.open("GET",this.master.cometUrl(["ack",this.master.socket_id],{mid:this.last_message_id})),this.pull_request.onload=t.bind(this.handle,this,"pull_load"),this.pull_request.onerror=t.bind(this.handle,this,"pull_error"),this.pull_request.send(),this._scheduleEvent("pull_timeout",this.hold_timeout),this.reconnect_state="ACK",this.transition("PULL")},_startReconnect:function(){this.reconnect_counter>5?(this.master.handle("disconnect",1006,"Reconnect failed"),this.transition("CLOSED")):(this._scheduleEvent("reconnect",1e3),this.transition("RECONNECT_WAIT"))},_fin:function(){this.fin_request=this.master.xhrObject(),this.fin_request.open("GET",this.master.cometUrl(["fin",this.master.socket_id])),this.fin_request.onload=t.bind(this.handle,this,"fin_load"),this.fin_request.onerror=t.bind(this.handle,this,"fin_error"),this.fin_request.send(),this.transition("FIN")},states:{CLOSED:{open:"SYN"},SYN:{_onEnter:function(){this.syn_request=this.master.xhrObject(),this.syn_request.open("GET",this.master.cometUrl(["syn"])),this.syn_request.onload=t.bind(this.handle,this,"syn_load"),this.syn_request.onerror=t.bind(this.handle,this,"syn_error"),this.syn_request.send(),this._scheduleEvent("syn_timeout",5e3)},syn_load:function(t){if(this._cancelEvent("syn_timeout"),"xhr"==this.master.mode)try{t=JSON.parse(this.syn_request.responseText)}catch(i){return this.transition("CLOSED"),void this.master.handle("connect_failed",i)}"c"==t.t?(this.master.socket_id=t.sid,this.hold_timeout=t.ht+2e3,this.master.handle("connect"),this._pull()):e.error("Unexpected syn response",t)},syn_error:function(t){e.error(t),this._cancelEvent("syn_timeout"),this.transition("CLOSED"),this.master.handle("connect_failed",t)},syn_timeout:function(){this.syn_request.onload=this.syn_request.onerror=function(){},this.syn_request.abort(),this.transition("CLOSED"),this.master.handle("connect_failed",new Error("Connection timed out"))}},PULL:{pull_load:function(t){if(this._cancelEvent("pull_timeout"),"xhr"==this.master.mode)try{t=JSON.parse(this.pull_request.responseText)}catch(i){return e.error("Error parsing pull response",this.pull_request.responseText,i.message),this.master.handle("disconnect",1006,"Connection reset"),void this.transition("CLOSED")}this.reconnect_counter=0,"k"==t.t?(this.hold_timeout=t.ht+2e3,this._pull()):"m"==t.t?(this.last_message_id=t.mid,this._ack(),this.master.handle("message",t.msg)):"r"==t.t?(this.master.handle("disconnect",1006,"Connection reset"),this.transition("CLOSED")):"d"==t.t&&(this.master.handle("disconnect",1e3,t.r),this.transition("CLOSED"))},pull_error:function(t){e.warn("Pull error",t),this._cancelEvent("pull_timeout"),this._startReconnect("PULL")},pull_timeout:function(){e.warn("Pull timeout"),this.pull_request.onload=this.pull_request.onerror=function(){},this.pull_request.abort(),this._startReconnect("PULL")},close:function(){this._cancelEvent("pull_timeout"),this.pull_request.onload=this.pull_request.onerror=function(){},this.pull_request.abort(),this._fin()}},RECONNECT_WAIT:{_onEnter:function(){this.hold_timeout=5e3},reconnect:function(){this.reconnect_counter+=1,"ACK"==this.reconnect_state?this._ack():this._pull()}},FIN:{_onEnter:function(){this._scheduleEvent("fin_timeout",2e3)},fin_timeout:function(){e.warn("FIN timeout"),this.transition("CLOSED")},fin_load:function(){this._cancelEvent("fin_timeout"),this.transition("CLOSED")},fin_error:function(t){e.error(t),this._cancelEvent("fin_timeout"),this.transition("CLOSED")}}}}),u=o.extend({initialState:"CLOSED",namespace:"SOCKET-PUSH",initialize:function(){this.queue=[]},_push:function(){this.push_request=this.master.xhrObject(),"jsonp"==this.master.mode?this.push_request.open("GET",this.master.cometUrl(["push",this.master.socket_id],{msg:this.queue[0]}),!0):(this.push_request.open("POST",this.master.cometUrl(["push",this.master.socket_id]),!0),this.push_request.setRequestHeader("Content-type","text/plain;charset=UTF-8")),this.push_request.onload=t.bind(this.handle,this,"push_load"),this.push_request.onerror=t.bind(this.handle,this,"push_error"),this.push_request.send(this.queue[0]),this.transition("PUSHING")},states:{CLOSED:{open:function(){this.transition("READY")},close:function(){}},READY:{push:function(e){this.queue.unshift(e),this._push()},close:function(){this.transition("CLOSED")}},PUSHING:{_onEnter:function(){this._scheduleEvent("push_timeout",3e3)},push:function(t){var i=this.queue.push(t);e.debug("Message put to queue",i)},push_load:function(){this._cancelEvent("push_timeout"),this.queue.shift(),this.queue.length>0?this._push():this.transition("READY")},push_error:function(t){e.error(this.master.socket_id+": push error",t)},close:function(){this._cancelEvent("push_timeout"),this.push_request.onload=this.push_request.onerror=function(){},this.push_request.abort(),this.transition("CLOSED")},push_timeout:function(){this.push_request.onload=this.push_request.onerror=function(){},this.push_request.abort(),this.transition("RETRY")}},RETRY:{_onEnter:function(){this._scheduleEvent("retry_push",2e3)},retry_push:function(){this._push()},push:function(t){var i=this.queue.push(t);e.debug(this.master.socket_id+": message put to queue",i)},close:function(){this._cancelEvent("push_timeout"),this.transition("CLOSED")}}}});r?module.exports=a:this.JivoConnection=a}.call(this);var connection=new TimeMachine({namespace:"CONMANAGER",msg_buf:[],sess_id:!1,send:function(e){log("SEND: ",e),this.handle("send",e)},sendIfConnected:function(e){this.isConnected()&&(log("SEND IF CONNECTION: ",e),this.handle("send",e))},resume:function(e){this.handle("resume",e)},initialize:function(){var e=!1;e=!0,this.jivoConnection=new JivoConnection(underscore.extend(underscore.clone(config.comet),{resource:"cometcn",mode:cookie("cm")||"ws",secure:e}));for(var t=["connect","message","disconnect","connection_reset","connect_failed"],i=0;i<t.length;i++)this.jivoConnection.on(t[i],underscore.bind(this.handle,this,"socket_"+t[i]))},_sendSocketEvent:function(e){"object"==typeof e?"name"in e?(log("Sending "+e.name),this.jivoConnection.push(e)):this.warn("Attempt to send event without name"):this.warn("Socket event must be object")},_bufferMessage:function(e){this.msg_buf.push(e)},_flushMessageBuffer:function(){for(var e;e=this.msg_buf.shift();)this.jivoConnection.push(e)},isConnected:function(){return"CONNECTED"===this.state},setCustomData:function(e){this.isConnected()?this.send({name:"update_custom_data",custom_data:e}):this.custom_data=e},setUserToken:function(e){this.isConnected()?this.send({name:"update_user_token",user_token:e}):this.user_token=e},updateClient:function(e){this.sendIfConnected(e)},states:{uninitialized:{send:function(e){this._bufferMessage(e),this.transition("CONNECTING")},resume:function(e){this.sess_id=e,this.transition("CONNECTING")},startup:function(){this.sess_id=!1,this.transition("CONNECTING")}},CONNECTING:{_onEnter:function(){this.jivoConnection.open()},socket_connect:function(e){cookie("cm",e),this.transition(this.sess_id?"RESUMING":"STARTING_UP")},send:function(e){this._bufferMessage(e)},socket_connect_failed:function(){jivo.handle("connect_failed"),this.transition("uninitialized")}},STARTING_UP:{_onEnter:function(){var e={name:"startup",jv_widget_id:config.widget_id,site_id:config.site_id,current_page:jivo.getCurrentPage(),is_mobile:jivo.isMobile(),chat_opened:"CHAT"===cookie("gui_state"),visits_count:cookie("visits_count")-0,page_visible:jivo._pageVisible()};cookie("client_id")&&(e.jv_client_id=cookie("client_id"),log("CONNECTION: restored client #"+e.jv_client_id)),cookie("__utmz")&&(e.g_utmz=cookie("__utmz")),cookie("agent_info")&&(e.pa_id=cookie("agent_info").split("$$")[0],log("CONNECTION: restored agent #"+e.pa_id)),cookie("client_name")&&(e.client_name=cookie("client_name"),log("CONNECTION: restored client name="+e.client_name)),cookie("email")&&(e.email=cookie("email"),log("CONNECTION: restored client email="+e.email)),cookie("phone")&&(e.phone=cookie("phone"),log("CONNECTION: restored client phone="+e.phone)),cookie("refer")&&(e.refer=cookie("refer"),cookie("utm")&&(e.utm=cookie("utm"))),jivo.invitationText&&(e.proactive_rule={invitation_text:jivo.invitationText,agent_info:jivo.agentInfo}),this.custom_data&&(e.custom_data=this.custom_data),this.user_token&&(e.user_token=this.user_token),this._sendSocketEvent(e),this._scheduleEvent("startup_timeout",3e3)},startup_timeout:function(){reportException({message:"Startup Timeout"})},send:function(e){this._bufferMessage(e)},socket_message:function(e){"startup_ok"===e.name?(this._cancelEvent("startup_timeout"),cookie("sess_id",e.jv_sess_id,{expires:1,path:"/"}),cookie("client_id",e.jv_client_id,{expires:365,path:"/"}),this.transition("CONNECTED")):"startup_error"===e.name&&(jivo.handle("force_offline",e),this.transition("DISCONNECTING"))}},RESUMING:{_onEnter:function(){this._sendSocketEvent({name:"resume",jv_sess_id:this.sess_id,jv_widget_id:config.widget_id,site_id:config.site_id,chat_opened:"CHAT"===cookie("gui_state"),visits_count:cookie("visits_count")-0,page_visible:jivo._pageVisible(),separate_window:jivo.isSeparateWindow(),current_page:jivo.getCurrentPage()})},socket_message:function(e){"resume_ok"==e.name?(jivo.handle(e.name,e),this.transition("CONNECTED")):(this.sess_id=!1,jivo.handle("resume_failed"),this.transition("DISCONNECTING"))}},CONNECTED:{_onEnter:function(){jivo.handle("startup_ok"),this._flushMessageBuffer()},socket_message:function(e){underscore.indexOf(["agent_chat_close","force_offline","blacklist"],e.name)>=0&&(jivo.isVisitorsInsight()||(cookie("sess_id",null),this.sess_id=!1,this.transition("DISCONNECTING")),"blacklist"===e.name&&cookie("client_id","z"+cookie("client_id"))),underscore.indexOf(["accept","transferred"],e.name)>=0&&cookie("agent_info",[e.agent_info.agent_id].join("$$")),jivo.handle(e.name,e)},send:function(e){this.jivoConnection.push(e)},socket_disconnect:function(e){1e3==e&&jivo.handle("reopened_elsewhere"),this.transition("uninitialized")}},DISCONNECTING:{_onEnter:function(){this.jivoConnection.close()},socket_disconnect:function(){this.transition("uninitialized")}}}}),JivoPhantom=TimeMachine.extend({namespace:"PHANTOM",element:!1,type:"chat",PHANTOM_ID:"jivo_phantom",TIMEOUT_TRANSITION:300,TIMEOUT_TRANSITION_DEBOUNCE:1,initialize:function(){function e(){this._transitionEndTimeout&&clearTimeout(this._transitionEndTimeout),this.handle("animate_finished")}element=this.element=document.createElement("div"),element.id=this.PHANTOM_ID,prefixedEvent(element,"TransitionEnd",this.handleTransitionEnd),this.topWrap.appendChild(element),addClass(element,"jivo-"+config.widget_orientation),element.style.background=config.widget_color,this.handleTransitionEnd=underscore.debounce(underscore.bind(e,this),this.TIMEOUT_TRANSITION_DEBOUNCE)},setRect:function(e){return setElementPosition(this.element,e),this},setTransition:function(e){return toggleClass(this.element,"jivo-notransition",!e),this},animate:function(e,t){var i=this.element,n="EXPANDING"===this.state;toggleClass(i,"jivo-phantom-chat",n),toggleClass(i,"jivo-phantom-label",!n),this.setTransition(!1).setRect(e,!0).setTransition(!0),setTimeout(underscore.bind(function(){this.setRect(t),this._transitionEndTimeout=setTimeout(this.handleTransitionEnd,this.TIMEOUT_TRANSITION)},this),0)},initialState:"HIDDEN",states:{ANIMATED:{_onEnter:function(){this.emit("animated"),this._scheduleEvent("hide",this.TIMEOUT_TRANSITION)},hide:"HIDDEN"},HIDDEN:{_onEnter:function(){this.setTransition(!1)},collapse:function(e,t){this.transition("COLLAPSING"),this.animate(t,e)},expand:function(e,t){this.transition("EXPANDING"),this.animate(e,t)}},EXPANDING:{animate_finished:"ANIMATED"},COLLAPSING:{animate_finished:"ANIMATED"}}}),analytics={_yaCounter:!1,_trackedEvents:[],_trackEvent:function(e,t){underscore.indexOf(this._trackedEvents,e)>=0||(this._trackedEvents.push(e),log("ANALYTICS _trackEvent: "+e+"/"+t),"undefined"!=typeof _gaq&&_gaq.push(["_trackEvent","JivoSite",e,t,void 0,!0]),"function"==typeof ga&&ga("send","event","JivoSite",e,t,{nonInteraction:1}),this._yaCounter&&(e=["Jivo"].concat(e.split(" ")).join("_"),window[this._yaCounter].reachGoal(e)))},_setCustomVar:function(e,t){if(log("ANALYTICS _setCustomVar: "+e+"/"+t),"undefined"!=typeof _gaq&&_gaq.push(["_setCustomVar",1,e,t,1]),"function"==typeof ga&&ga("set",e,t),this._yaCounter){var i={};i[e]=t,window[this._yaCounter].params(i)}},findYaCounter:function(){try{for(var e in window)0==e.indexOf("yaCounter")&&"function"==typeof window[e].reachGoal&&(this._yaCounter=e)}catch(t){log("ANALYTICS: "+t.toString())}},trackChatOpenedByClick:function(){this._trackEvent("Chat requested","User clicked chat widget")},trackOfflineFormOpenedByClick:function(){this._trackEvent("Offline form shown","User offline form")},trackOfflineMessageSent:function(){this._trackEvent("Offline message sent","User sent message via offline form")},trackProactiveInvitationShown:function(e){this._trackEvent("Proactive invitation shown",e)},trackProactiveInvitationAccepted:function(e){this._trackEvent("Proactive invitation accepted",e)},trackProactiveInvitationRejected:function(e){this._trackEvent("Proactive invitation rejected",e)},trackChatConnected:function(){this._trackEvent("Chat established","User connected to agent")},trackGaveContacts:function(){this._trackEvent("User gave contacts during chat","User gave contacts during chat")},setABTestGroupContacts:function(e,t){this._setCustomVar(e,t)}};analytics.findYaCounter();var jivo_api=window.jivo_api={open:function(e){jivo.handle("api_open",e)},getContactInfo:function(){if(underscore.find(utils.fields,function(e){return cookie(e)})){var e={};return underscore.each(utils.fields,function(t){cookie(t)&&(e["client_name"===t?"name":t]=cookie(t))}),e}},getVisitorNumber:function(e){var t=cookie("client_id"),i={};if(t){if(-1!==t.indexOf("."))return void setTimeout(e(null,t.substring(0,t.indexOf("."))),0);i=this.getContactInfo()?this.getContactInfo():{},i.client_id=t}getJSONPWithData(config.base_url+"/script/get-visitor-number/"+config.widget_id,i,function(t){"object"==typeof t&&t.result&&"client_id"in t&&(cookie("client_id",t.client_id,{expires:365,path:"/"}),"function"==typeof e&&("client_number"in t?e(null,t.client_number):e(new Error("JIVO API ERROR: client number is not defined"))))})},setUserToken:function(e){("string"==typeof e||e instanceof String)&&connection.setUserToken(e)},setCustomData:function(e){"[object Array]"===Object.prototype.toString.call(e)&&connection.setCustomData(e)},setContactInfo:function(e){if(e&&"object"==typeof e)for(var t in e){var i=e[t],n={},o=!1;underscore.find(utils.fields,function(e){return"client_name"===e?"name"===t:e===t})&&!cookie("name"===t?"client_name":t)&&utils["isValidValue_"+t](i)&&(n[t]=i,o=!0),o&&jivo.handle("gui_introduced",n,!0)}},showProactiveInvitation:function(e,t){ruleManager.showProactive(e,t,"jivo_api.showProactiveInvitation")}},site_iframe={frm:0,create:function(){if(config.disable_iframe)return void log("Magic iframe is disabled");if(this.frm)return void log("Magic iframe already created");if(cookie("mframe"))return void log("Magic iframe create cancelled, page may be protected from iframe");cookie("mframe",1),log("Creating iframe");var e=document.createElement("iframe");e.setAttribute("id","jivo_magic_iframe"),e.setAttribute("class","jivo-frame-hidden"),e.setAttribute("frameborder","0px"),e.setAttribute("name","col_old_page"),document.body.appendChild(e),e.contentWindow.location=window.location,this.frm=e,setIframeLoadCallback(e,underscore.bind(this.onFrameLoaded,this))},onFrameLoaded:function(){log("Magic frame content loaded. Time to show the frame...");document.getElementById("jivo_top_wrap");document.body.setAttribute("id","jivo_outer_body"),document.body.style.overflow="hidden",document.body.scroll="no";for(var e=document.getElementsByTagName("iframe"),t=0;t<e.length;t++){var i=e[t];"jivo_magic_iframe"!=i.id&&"jivo_chat_iframe"!=i.id&&(i.style.display="none")}if(this.frm.setAttribute("class","jivo-frame-visible"),this.frm.style.display="block",this.hasScroll().vScrollbar){var n=this.getScrollBarWidth()+"px";log("Adjusting right margin. Scroll width="+n),document.getElementById("jivo-chat").style.marginRight=n,document.getElementById("jivo-label").style.marginRight=n}this.syncPageScroll()},navigate:function(e){log("navigating iframe to ",e),this.frm.contentDocument.location.href=e},getDoc:function(){var e=this.frm.contentWindow.document;return e||(e=this.frm.contentDocument),e?e:(log("Cannot find document!! :("),0)},syncPageScroll:function(){var e=0,t=0;"number"==typeof window.pageYOffset?(t=window.pageYOffset,e=window.pageXOffset):document.body&&(document.body.scrollLeft||document.body.scrollTop)?(t=document.body.scrollTop,e=document.body.scrollLeft):document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)&&(t=document.documentElement.scrollTop,e=document.documentElement.scrollLeft),log("scroll pos x="+e+" y="+t),this.frm.contentWindow.scrollTo(e,t)},getScrollBarWidth:function(){var e=document.createElement("div");e.style.visibility="hidden",e.style.width="100px",document.body.appendChild(e);var t=e.offsetWidth;e.style.overflow="scroll";var i=document.createElement("div");i.style.width="100%",e.appendChild(i);var n=i.offsetWidth;return e.parentNode.removeChild(e),t-n},hasScroll:function(){var e={vScrollbar:!0,hScrollbar:!0};try{var t="BackCompat"==document.compatMode?document.body:document.documentElement;e.vScrollbar=t.scrollHeight>t.clientHeight,e.hScrollbar=t.scrollWidth>t.clientWidth}catch(i){}return e}},coBrowserIframeCreater=window.coBrowserIframeCreater=function(){function e(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent&&(e.attachEvent("on"+t,function(e){return function(){i.call(e,window.event)}}(e)),e=null)}var t,i,n=!1,o=[],s=!1,r={},a=function(e,c){log("coBrowserIframeCreater has received event "+e);var l=document.getElementById("jivo_frame");if(l||(l=jivoFrame.init(function(){log("jivoFrame has been inited"),t&&t.postMessage({name:"widget_ready"},i),n=!0,a()})),!n)return void o.push({name:e,params:c});if(o.length){var u=o.shift();e=u.name,c=u.params}var d;if(s){log("controller of childSandboxBridge set as for NodeWebkit"),d=l.contentWindow.jqueryFrameControllerForAir,d.setLangpack(r);var h=document.createElement("link");h.setAttribute("rel","stylesheet"),h.setAttribute("href",staticUrl("/css/for_air.css")),document.body.appendChild(h),d.init()}else d=l.contentWindow.jqueryFrameController;d[e]&&"is_node_webkit"!=e?d[e](c):log("controller has not "+e),o.length&&a()},c=!1;return e(window,"message",function(e){var n=e.data;"in_node_webkit"==n.name&&(t||(t=e.source,i=e.origin),s=!0,r=n.langpack,c=!0),c&&i==e.origin&&a(n.name,n)},!1),{process:function(e,t){a(e,t)},postMessage:function(e){t&&t.postMessage(e,i)},isNodeWebkit:function(){return s}}}(),jqueryFrame=window.childSandboxBridge={_queue:[],_ready:0,_inAir:0,process:function(e,t){var i=document.getElementById("jivo_frame");if(i||(window.parentSandboxBridge&&window.parentSandboxBridge.inAir&&(this._inAir=!0),i=jivoFrame.init(function(){
log("jivoFrame has been inited"),window.parentSandboxBridge&&window.parentSandboxBridge.process("onJqueryIframeReady"),childSandboxBridge._ready=!0,childSandboxBridge.process()})),!this._ready)return void this._queue.push({name:e,params:t});if(this._queue.length){var n=this._queue.shift();e=n.name,t=n.params}var o;if(this.inAir()){log("controller of childSandboxBridge set as for Air"),o=i.contentWindow.jqueryFrameControllerForAir;var s=document.createElement("link");s.setAttribute("rel","stylesheet"),s.setAttribute("href",staticUrl("/css/for_air.css")),document.body.appendChild(s),o.init()}else o=i.contentWindow.jqueryFrameController;log("childSandboxBridge has received event "+e),o[e]?o[e](t):log("controller has not "+e),this._queue.length&&this.process()},inAir:function(){return this._inAir}};if(window.parentSandboxBridge){var log=function(e){window.parentSandboxBridge.log(e)};log("parentSandboxBridge.initInterface() called"),window.parentSandboxBridge.initInterface()}var jivoFrame={_content:"<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>		<html>		<head>			<meta http-equiv='Content-Type' content='text/html; charset=utf-8' />			<script type='text/javascript'  src='"+staticUrl("/js/jquery_frame.js")+"'></script>			<script type='text/javascript'>    lblDefaultCobrowseComment='"+translate("lblDefaultCobrowseComment")+"';			</script>		</head>		<body >		</body>        </html>",_iframe:0,init:function(e){return this._iframe=document.createElement("iframe"),this._iframe.setAttribute("id","jivo_frame"),this._iframe.setAttribute("frameBorder","0"),this._iframe.setAttribute("scrolling","no"),this._iframe.allowTransparency=!0,this._iframe.style.backgroundColor="transparent",this._iframe.style.display="none",window.document.body.appendChild(this._iframe),setIframeLoadCallback(this._iframe,e),this._doc=this._getDoc(),this._doc.open(),this._doc.write(this._content),this._doc.close(),this._window=this._iframe.contentWindow,this._iframe.contentWindow.controller=this,this._iframe},_getDoc:function(){return this._iframe.contentDocument?this._iframe.contentDocument:this._iframe.contentWindow?this._iframe.contentWindow.document:(log("WARNING! chat_iframe._doc is null"),0)}}})();var widgetContainer,widgetLoaded;jivo.isMobile()?widgetLoaded=setInterval(function(){widgetContainer=document.getElementById("jivo_top_wrap"),widgetContainer&&!jivo.ignore_viewport&&(widgetContainer.className+="mobile-version",document.getElementById("jivo-label").style.right="auto",jivoMobileLabel(),clearInterval(widgetLoaded))},100):jivo.isTablet()&&(widgetLoaded=setInterval(function(){widgetContainer=document.getElementById("jivo_top_wrap"),widgetContainer&&(widgetContainer.className+="tablet-version",clearInterval(widgetLoaded))},100));